<!DOCTYPE HTML>
<html lang="en" class="sidebar-visible no-js light">
    <head>
        <!-- Book generated using mdBook -->
        <meta charset="UTF-8">
        <title></title>
        
        <meta name="robots" content="noindex" />
        
        


        <!-- Custom HTML head -->
        


        <meta content="text/html; charset=utf-8" http-equiv="Content-Type">
        <meta name="description" content="">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="theme-color" content="#ffffff" />

        <link rel="icon" href="favicon.svg">
        <link rel="shortcut icon" href="favicon.png">
        <link rel="stylesheet" href="css/variables.css">
        <link rel="stylesheet" href="css/general.css">
        <link rel="stylesheet" href="css/chrome.css">
        <link rel="stylesheet" href="css/print.css" media="print">

        <!-- Fonts -->
        <link rel="stylesheet" href="FontAwesome/css/font-awesome.css">
        
        <link rel="stylesheet" href="fonts/fonts.css">
        

        <!-- Highlight.js Stylesheets -->
        <link rel="stylesheet" href="highlight.css">
        <link rel="stylesheet" href="tomorrow-night.css">
        <link rel="stylesheet" href="ayu-highlight.css">

        <!-- Custom theme stylesheets -->
        

        
    </head>
    <body>
        <!-- Provide site root to javascript -->
        <script type="text/javascript">
            var path_to_root = "";
            var default_theme = window.matchMedia("(prefers-color-scheme: dark)").matches ? "navy" : "light";
        </script>

        <!-- Work around some values being stored in localStorage wrapped in quotes -->
        <script type="text/javascript">
            try {
                var theme = localStorage.getItem('mdbook-theme');
                var sidebar = localStorage.getItem('mdbook-sidebar');

                if (theme.startsWith('"') && theme.endsWith('"')) {
                    localStorage.setItem('mdbook-theme', theme.slice(1, theme.length - 1));
                }

                if (sidebar.startsWith('"') && sidebar.endsWith('"')) {
                    localStorage.setItem('mdbook-sidebar', sidebar.slice(1, sidebar.length - 1));
                }
            } catch (e) { }
        </script>

        <!-- Set the theme before any content is loaded, prevents flash -->
        <script type="text/javascript">
            var theme;
            try { theme = localStorage.getItem('mdbook-theme'); } catch(e) { }
            if (theme === null || theme === undefined) { theme = default_theme; }
            var html = document.querySelector('html');
            html.classList.remove('no-js')
            html.classList.remove('light')
            html.classList.add(theme);
            html.classList.add('js');
        </script>

        <!-- Hide / unhide sidebar before it is displayed -->
        <script type="text/javascript">
            var html = document.querySelector('html');
            var sidebar = 'hidden';
            if (document.body.clientWidth >= 1080) {
                try { sidebar = localStorage.getItem('mdbook-sidebar'); } catch(e) { }
                sidebar = sidebar || 'visible';
            }
            html.classList.remove('sidebar-visible');
            html.classList.add("sidebar-" + sidebar);
        </script>

        <nav id="sidebar" class="sidebar" aria-label="Table of contents">
            <div class="sidebar-scrollbox">
                <ol class="chapter"><li class="chapter-item expanded "><a href="about.html"><strong aria-hidden="true">1.</strong> å…³äº</a></li><li class="chapter-item expanded "><a href="Rust/index.html"><strong aria-hidden="true">2.</strong> Rust</a></li><li><ol class="section"><li class="chapter-item expanded "><a href="Rust/rust_error_handle.html"><strong aria-hidden="true">2.1.</strong> ç»†è¯´Rusté”™è¯¯å¤„ç†</a></li><li class="chapter-item expanded "><a href="Rust/crates_private_alternative_registry.html"><strong aria-hidden="true">2.2.</strong> Rust cratesç§æœ‰åŒ–éƒ¨ç½²æŒ‡å—</a></li><li class="chapter-item expanded "><a href="Rust/advice_rust_code_with_block.html"><strong aria-hidden="true">2.3.</strong> Rustä»£ç ä¼˜åŒ–-é—­åŒ…æƒ°æ€§æ±‚å€¼</a></li></ol></li><li class="chapter-item expanded "><a href="Golang/readmd.html"><strong aria-hidden="true">3.</strong> Golang</a></li></ol>
            </div>
            <div id="sidebar-resize-handle" class="sidebar-resize-handle"></div>
        </nav>

        <div id="page-wrapper" class="page-wrapper">

            <div class="page">
                
                <div id="menu-bar-hover-placeholder"></div>
                <div id="menu-bar" class="menu-bar sticky bordered">
                    <div class="left-buttons">
                        <button id="sidebar-toggle" class="icon-button" type="button" title="Toggle Table of Contents" aria-label="Toggle Table of Contents" aria-controls="sidebar">
                            <i class="fa fa-bars"></i>
                        </button>
                        <button id="theme-toggle" class="icon-button" type="button" title="Change theme" aria-label="Change theme" aria-haspopup="true" aria-expanded="false" aria-controls="theme-list">
                            <i class="fa fa-paint-brush"></i>
                        </button>
                        <ul id="theme-list" class="theme-popup" aria-label="Themes" role="menu">
                            <li role="none"><button role="menuitem" class="theme" id="light">Light (default)</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="rust">Rust</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="coal">Coal</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="navy">Navy</button></li>
                            <li role="none"><button role="menuitem" class="theme" id="ayu">Ayu</button></li>
                        </ul>
                        
                        <button id="search-toggle" class="icon-button" type="button" title="Search. (Shortkey: s)" aria-label="Toggle Searchbar" aria-expanded="false" aria-keyshortcuts="S" aria-controls="searchbar">
                            <i class="fa fa-search"></i>
                        </button>
                        
                    </div>

                    <h1 class="menu-title"></h1>

                    <div class="right-buttons">
                        <a href="print.html" title="Print this book" aria-label="Print this book">
                            <i id="print-button" class="fa fa-print"></i>
                        </a>
                        
                    </div>
                </div>

                
                <div id="search-wrapper" class="hidden">
                    <form id="searchbar-outer" class="searchbar-outer">
                        <input type="search" name="search" id="searchbar" name="searchbar" placeholder="Search this book ..." aria-controls="searchresults-outer" aria-describedby="searchresults-header">
                    </form>
                    <div id="searchresults-outer" class="searchresults-outer hidden">
                        <div id="searchresults-header" class="searchresults-header"></div>
                        <ul id="searchresults">
                        </ul>
                    </div>
                </div>
                

                <!-- Apply ARIA attributes after the sidebar and the sidebar toggle button are added to the DOM -->
                <script type="text/javascript">
                    document.getElementById('sidebar-toggle').setAttribute('aria-expanded', sidebar === 'visible');
                    document.getElementById('sidebar').setAttribute('aria-hidden', sidebar !== 'visible');
                    Array.from(document.querySelectorAll('#sidebar a')).forEach(function(link) {
                        link.setAttribute('tabIndex', sidebar === 'visible' ? 0 : -1);
                    });
                </script>

                <div id="content" class="content">
                    <main>
                        <h1><a class="header" href="#ä»‹ç»" id="ä»‹ç»">ä»‹ç»</a></h1>
<h1><a class="header" href="#rust" id="rust">Rust</a></h1>
<h1><a class="header" href="#ç»†è¯´rusté”™è¯¯å¤„ç†" id="ç»†è¯´rusté”™è¯¯å¤„ç†">ç»†è¯´Rusté”™è¯¯å¤„ç†</a></h1>
<ul>
<li><a href="Rust/rust_error_handle.html#%E7%BB%86%E8%AF%B4rust%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86">ç»†è¯´Rusté”™è¯¯å¤„ç†</a>
<ul>
<li><a href="Rust/rust_error_handle.html#1-%E5%89%8D%E8%A8%80">1. å‰è¨€</a></li>
<li><a href="Rust/rust_error_handle.html#2-%E8%83%8C%E6%99%AF">2. èƒŒæ™¯</a></li>
<li><a href="Rust/rust_error_handle.html#3-unwrap%E7%9A%84%E5%8D%B1%E5%AE%B3">3. unwrapçš„å±å®³!</a></li>
<li><a href="Rust/rust_error_handle.html#4-%E5%AF%B9%E6%AF%94%E8%AF%AD%E8%A8%80%E5%A4%84%E7%90%86%E9%94%99%E8%AF%AF">4. å¯¹æ¯”è¯­è¨€å¤„ç†é”™è¯¯</a>
<ul>
<li><a href="Rust/rust_error_handle.html#41-golang%E7%9A%84%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86%E6%BC%94%E7%A4%BA">4.1 golangçš„é”™è¯¯å¤„ç†æ¼”ç¤º</a></li>
<li><a href="Rust/rust_error_handle.html#42-rust-%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86%E7%A4%BA%E4%BE%8B">4.2 Rust é”™è¯¯å¤„ç†ç¤ºä¾‹</a></li>
</ul>
</li>
<li><a href="Rust/rust_error_handle.html#5-rust%E4%B8%AD%E7%9A%84%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86">5. Rustä¸­çš„é”™è¯¯å¤„ç†</a></li>
<li><a href="Rust/rust_error_handle.html#6-%E8%87%AA%E5%AE%9A%E4%B9%89error%E8%BD%AC%E6%8D%A2from">6. è‡ªå®šä¹‰Errorè½¬æ¢:From</a></li>
<li><a href="Rust/rust_error_handle.html#7-%E9%87%8D%E5%91%BD%E5%90%8Dresult">7. é‡å‘½åResult</a></li>
<li><a href="Rust/rust_error_handle.html#8-option%E8%BD%AC%E6%8D%A2">8. Optionè½¬æ¢</a></li>
<li><a href="Rust/rust_error_handle.html#9-%E9%81%BF%E5%85%8Dunwrap">9. é¿å…unwrap()</a></li>
<li><a href="Rust/rust_error_handle.html#10-%E8%87%AA%E5%AE%9A%E4%B9%89error%E5%90%8C%E7%BA%A7%E8%BD%AC%E6%8D%A2">10. è‡ªå®šä¹‰ErroråŒçº§è½¬æ¢</a></li>
<li><a href="Rust/rust_error_handle.html#11-error%E5%B8%B8%E8%A7%81%E5%BC%80%E6%BA%90%E5%BA%93">11. Errorå¸¸è§å¼€æºåº“</a></li>
<li><a href="Rust/rust_error_handle.html#12-%E5%8F%82%E8%80%83%E9%93%BE%E6%8E%A5">12. å‚è€ƒé“¾æ¥</a></li>
<li><a href="Rust/rust_error_handle.html#13-%E9%94%99%E8%AF%AF%E5%A4%84%E7%90%86%E5%AE%9E%E6%88%98">13 é”™è¯¯å¤„ç†å®æˆ˜</a></li>
<li><a href="Rust/rust_error_handle.html#14-%E6%80%BB%E7%BB%93">14. æ€»ç»“</a></li>
</ul>
</li>
</ul>
<p><img src="https://github.com/baoyachi/rust-error-handle/raw/master/handle_error.png" alt="handle-error.png" /></p>
<p>åŸæ–‡åœ°å€:<a href="https://github.com/baoyachi/rust-error-handle">https://github.com/baoyachi/rust-error-handle</a></p>
<h2><a class="header" href="#1-å‰è¨€" id="1-å‰è¨€">1. å‰è¨€</a></h2>
<p>è¿™ç¯‡æ–‡ç« å†™å¾—æ¯”è¾ƒé•¿ï¼Œå…¨æ–‡è¯»å®Œå¤§çº¦éœ€è¦15-20minï¼Œå¦‚æœå¯¹<code>Rust</code>çš„é”™è¯¯å¤„ç†ä¸æ¸…æ¥šæˆ–è¿˜æœ‰äº›è®¸æ¨¡ç³Šçš„åŒå­¦ï¼Œè¯·é™ä¸‹å¿ƒæ¥ç»†ç»†é˜…è¯»ã€‚å½“è¯»å®Œè¯¥ç¯‡æ–‡ç« åï¼Œå¯ä»¥è¯´å¯¹<code>Rust</code>çš„é”™è¯¯å¤„ç†å¯ä»¥åšåˆ°æŒæ¡è‡ªå¦‚ã€‚</p>
<p>ç¬”è€…èŠ±è´¹è¾ƒé•¿ç¯‡å¹…æ¥æè¿°<strong>é”™è¯¯å¤„ç†</strong>çš„æ¥å»ï¼Œè¯¦ç»†ä»‹ç»å…¶åŠä¸€æ­¥æ­¥æ¢³ç†å†…å®¹ï¼Œæœ›å¤§å®¶èƒ½è€å¿ƒè¯»å®Œåå¯¹å¤§å®¶æœ‰æ‰€å¸®åŠ©ã€‚å½“ç„¶ï¼Œåœ¨å†™è¿™ç¯‡æ–‡ç« ä¹‹æ—¶ï¼Œä¹Ÿå€Ÿé˜…äº†å¤§é‡äº’è”ç½‘èµ„æ–™ï¼Œè¯¦è§é“¾æ¥è§åº•éƒ¨<strong>å‚è€ƒé“¾æ¥</strong></p>
<p>æŒæ¡å¥½<code>Rust</code>çš„é”™è¯¯è®¾è®¡ï¼Œä¸ä»…å¯ä»¥æå‡æˆ‘ä»¬å¯¹é”™è¯¯å¤„ç†çš„è®¤è¯†ï¼Œå¯¹ä»£ç ç»“æ„ã€å±‚æ¬¡éƒ½æœ‰å¾ˆå¤§çš„å¸®åŠ©ã€‚é‚£åºŸè¯ä¸å¤šè¯´ï¼Œé‚£æˆ‘ä»¬å¼€å¯è¿™æ®µé˜…è¯»ä¹‹æ—…å§ğŸ˜„ï¼</p>
<h2><a class="header" href="#2-èƒŒæ™¯" id="2-èƒŒæ™¯">2. èƒŒæ™¯</a></h2>
<p>ç¬”è€…åœ¨å†™è¿™ç¯‡æ–‡ç« æ—¶ï¼Œä¹Ÿç¿»é˜…ä¸€äº›èµ„æ–™å…³äº<code>Rust</code>çš„é”™è¯¯å¤„ç†èµ„æ–™ï¼Œå¤šæ•°æ˜¯å¯¹å…¶ä¸€ç¬”å¸¦è¿‡ï¼Œå¯¼è‡´ä¹‹å‰æ¥è§¦è¿‡å…¶ä»–è¯­è¨€çš„æ–°åŒå­¦æ¥è¯´ï¼Œä¸Šæ‰‹å¤„ç†<code>Rust</code>çš„é”™è¯¯ä¼šæœ‰<strong>å½“å¤´æ£’å–</strong>çš„æ„Ÿè§‰ã€‚æ‰¾äº›èµ„æ–™å‘ç°<strong>unwrap()<strong>ä¹Ÿå¯ä»¥è§£å†³é—®é¢˜ï¼Œç„¶åå¿ƒä¸­æš—è‡ªçªƒå–œï¼Œç¨‹åºåœ¨è¿è¡Œè¿‡ç¨‹ä¸­ï¼Œ<strong>å› ä¸ºå¿½ç•¥æ£€æŸ¥æˆ–ç¨‹åºé€»è¾‘åˆ¤æ–­</strong>ï¼Œå¯¼è‡´æŸäº›æƒ…å†µï¼Œç¨‹åº</strong>panic</strong>ã€‚è¿™å¯èƒ½æ˜¯æˆ‘ä»¬æœ€ä¸æ„¿çœ‹åˆ°çš„ç°è±¡ï¼Œé‚åˆå›åˆ°èµ·ç‚¹ï¼Œé‡æ–°å»äº†è§£<code>Rust</code>çš„é”™è¯¯å¤„ç†ã€‚</p>
<p>è¿™ç¯‡æ–‡ç« ï¼Œé€šè¿‡ä¸€æ­¥æ­¥ä»‹ç»ï¼Œè®©å¤§å®¶æ¸…æ™°çŸ¥é“<code>Rust</code>çš„é”™è¯¯å¤„ç†çš„ç©¶ç«Ÿã€‚ä»‹ç»åœ¨<code>Rust</code>ä¸­çš„é”™è¯¯ä½¿ç”¨åŠå¦‚ä½•å¤„ç†é”™è¯¯ï¼Œä»¥åŠåœ¨å®é™…å·¥ä½œä¸­å…³äºå…¶ä½¿ç”¨æŠ€å·§ã€‚</p>
<h2><a class="header" href="#3-unwrapçš„å±å®³" id="3-unwrapçš„å±å®³">3. unwrapçš„å±å®³!</a></h2>
<p>ä¸‹é¢æˆ‘ä»¬æ¥çœ‹ä¸€æ®µä»£ç ,æ‰§è¡Œä¸€ä¸‹ï¼š</p>
<pre><pre class="playground"><code class="language-rust">fn main() {
    let path = &quot;/tmp/dat&quot;;
    println!(&quot;{}&quot;, read_file(path));
}

fn read_file(path: &amp;str) -&gt; String {
    std::fs::read_to_string(path).unwrap()
}
</code></pre></pre>
<p>ç¨‹åºæ‰§è¡Œç»“æœï¼š</p>
<pre><code class="language-bash">thread 'main' panicked at 'called `Result::unwrap()` on an `Err` value: Os { code: 2, kind: NotFound, message: &quot;No such file or directory&quot; }', src/libcore/result.rs:1188:5
stack backtrace:
   0: backtrace::backtrace::libunwind::trace
             at /Users/runner/.cargo/registry/src/github.com-1ecc6299db9ec823/backtrace-0.3.40/src/backtrace/libunwind.rs:88
  ...
  15: rust_sugar::read_file
             at src/main.rs:7
  16: rust_sugar::main
             at src/main.rs:3
  ...
  25: rust_sugar::read_file
note: Some details are omitted, run with `RUST_BACKTRACE=full` for a verbose backtrace.
</code></pre>
<p>ä»€ä¹ˆï¼Œå› ä¸º<code>path</code>è·¯å¾„ä¸å¯¹ï¼Œç¨‹åºç«Ÿç„¶å´©æºƒäº†ï¼Œè¿™ä¸ªæ˜¯æˆ‘ä»¬ä¸èƒ½æ¥å—çš„ï¼</p>
<p><strong>unwrap()</strong> è¿™ä¸ªæ“ä½œåœ¨rustä»£ç ä¸­ï¼Œåº”è¯¥çœ‹è¿‡å¾ˆå¤šè¿™ç§ä»£ç ï¼Œç”šè‡³æ­¤æ—¶æˆ‘ä»¬æ­£åœ¨ä½¿ç”¨å®ƒã€‚å®ƒä¸»è¦ç”¨äº<code>Option</code>æˆ–<code>Result</code>çš„æ‰“å¼€å…¶åŒ…è£…çš„ç»“æœã€‚å¸¸å¸¸æˆ‘ä»¬åœ¨ä»£ç ä¸­ï¼Œä½¿ç”¨ç®€å•ï¼Œæˆ–å¿«é€Ÿå¤„ç†ï¼Œä½¿ç”¨äº† <strong>unwrap()</strong> çš„æ“ä½œï¼Œä½†æ˜¯ï¼Œå®ƒæ˜¯ä¸€ä¸ªéå¸¸å±é™©çš„ä¿¡å·!</p>
<p>å¯èƒ½å› ä¸º<strong>æ²¡æœ‰ç¨‹åºæ£€æŸ¥æˆ–æ ¡éªŒ</strong>ï¼Œæ½œåœ¨çš„bugå¯èƒ½å°±å‡ºç°å…¶ä¸­ï¼Œä½¿å¾—æˆ‘ä»¬ç¨‹åºå¾€å¾€å°±<strong>panic</strong>äº†ã€‚è¿™å¯èƒ½ä½¿æˆ‘ä»¬æœ€ä¸æ„¿çœ‹åˆ°çš„ç°è±¡ã€‚</p>
<p>åœ¨å®é™…é¡¹ç›®å¼€å‘ä¸­ï¼Œç¨‹åºä¸­å¯èƒ½å……æ–¥ç€å¤§é‡ä»£ç ï¼Œæˆ‘ä»¬å¾ˆéš¾é¿å…<strong>unwrap()<strong>çš„å‡ºç°ï¼Œä¸ºäº†è§£å†³è¿™ç§é—®é¢˜ï¼Œæˆ‘ä»¬é€šè¿‡åš</strong>code review</strong>,æˆ–ä½¿ç”¨è„šæœ¬å·¥å…·æ£€æŸ¥å…¶é™ä½å…¶å‡ºç°çš„å¯èƒ½æ€§ã€‚</p>
<p>é€šå¸¸æ¯ä¸ªé¡¹ç›®éƒ½æœ‰ä¸€äº›çº¦æŸï¼Œæˆ–è®¸ï¼šåœ¨å¤§å‹é¡¹ç›®å¼€å‘ä¸­ï¼Œ ä¸ç”¨<strong>unwrap()</strong> æ–¹æ³•ï¼Œä½¿ç”¨å…¶ä»–æ–¹å¼å¤„ç†ç¨‹åºï¼Œ<strong>unwrap()</strong> çš„ä¸å‡ºç°å¯èƒ½ä¼šä½¿å¾—ç¨‹åºçš„å¥å£®æ€§é«˜å‡ºå¾ˆå¤šã€‚</p>
<p>è¿™é‡Œå‰ææ˜¯å›¢é˜Ÿæˆ–å¤§å‹é¡¹ç›®ï¼Œå¦‚æœåªæ˜¯å†™ä¸€ä¸ªç®€å•ä¾‹å­ï¼ˆdemoï¼‰å°±ä¸åœ¨æœ¬ç¯‡æ–‡ç« çš„è®¨è®ºèŒƒç•´ã€‚å› ä¸ºä¸€ä¸ªDemoçš„é—®é¢˜ï¼Œå¯èƒ½åªæ˜¯å¿«é€Ÿ<strong>ç¤ºèŒƒæˆ–æ¼”ç¤º</strong>ï¼Œä¸è€ƒè™‘ç¨‹åºå¥å£®æ€§, <strong>unwrap()</strong> çš„æ“ä½œå¯èƒ½ä¼šæ›´æ–¹ä¾¿ä»£ç è¡¨è¾¾ã€‚</p>
<p>å¯èƒ½æœ‰äººä¼šé—®ï¼Œæˆ‘ä»¬é€šå¸¸è·‘ç¨‹åº<strong>unit test</strong>ï¼Œå…¶ä¸­çš„å¾ˆå¤š<strong>mock</strong>æ•°æ®ä¼šæœ‰ <strong>unwrap()</strong> çš„æ“ä½œï¼Œæˆ‘ä»¬åªæ˜¯ä¸ºäº†åœ¨å•å…ƒæµ‹è¯•ä¸­ä½¿å¾—ç¨‹åºç®€å•ã€‚è¿™ç§ä¹Ÿèƒ½ä¸ä½¿ç”¨å—ï¼Ÿç­”æ¡ˆï¼šæ˜¯çš„ï¼Œå®Œå…¨å¯ä»¥ä¸ä½¿ç”¨ <strong>unwrap()</strong> ä¹Ÿå¯ä»¥åšåˆ°çš„ã€‚</p>
<h2><a class="header" href="#4-å¯¹æ¯”è¯­è¨€å¤„ç†é”™è¯¯" id="4-å¯¹æ¯”è¯­è¨€å¤„ç†é”™è¯¯">4. å¯¹æ¯”è¯­è¨€å¤„ç†é”™è¯¯</a></h2>
<p>è¯´åˆ°<strong>unwrap()</strong>ï¼Œæˆ‘ä»¬ä¸å¾—ä¸æåˆ°<code>rust</code>çš„é”™è¯¯å¤„ç†ï¼Œ<strong>unwrap()</strong> å’Œ<code>Rust</code>çš„é”™è¯¯å¤„ç†æ˜¯å¯†ä¸å¯åˆ†çš„ã€‚</p>
<h3><a class="header" href="#41-golangçš„é”™è¯¯å¤„ç†æ¼”ç¤º" id="41-golangçš„é”™è¯¯å¤„ç†æ¼”ç¤º">4.1 golangçš„é”™è¯¯å¤„ç†æ¼”ç¤º</a></h3>
<p>å¦‚æœäº†è§£<code>golang</code>çš„è¯ï¼Œåº”è¯¥æ¸…æ¥šä¸‹é¢è¿™æ®µä»£ç çš„æ„æ€ï¼š</p>
<pre><code class="language-go">package main

import (
    &quot;io/ioutil&quot;
    &quot;log&quot;
)

func main() {
    path := &quot;/tmp/dat&quot;  //æ–‡ä»¶è·¯å¾„
    file, err := readFile(path) 
    if err != nil {
        log.Fatal(err) //é”™è¯¯æ‰“å°
    }
    println(&quot;%s&quot;, file) //æ‰“å°æ–‡ä»¶å†…å®¹
}

func readFile(path string) (string, error) {
    dat, err := ioutil.ReadFile(path)  //è¯»å–æ–‡ä»¶å†…å®¹
    if err != nil {  //åˆ¤æ–­erræ˜¯å¦ä¸ºnil
        return &quot;&quot;, err  //ä¸ä¸ºnil,è¿”å›errç»“æœ
    }
    return string(dat), nil  //err=nil,è¿”å›è¯»å–æ–‡ä»¶å†…å®¹
}
</code></pre>
<p>æˆ‘ä»¬æ‰§è¡Œä¸‹ç¨‹åºï¼Œæ‰“å°å¦‚ä¸‹ã€‚æ‰§è¡Œé”™è¯¯ï¼Œå½“ç„¶ï¼Œå› ä¸ºæˆ‘ä»¬ç»™çš„æ–‡ä»¶è·¯å¾„ä¸å­˜åœ¨ï¼Œç¨‹åºæŠ¥é”™ã€‚</p>
<pre><code class="language-bash">2020/02/24 01:24:04 open /tmp/dat: no such file or directory
</code></pre>
<p>è¿™é‡Œï¼Œ<code>golang</code>é‡‡ç”¨å¤šè¿”å›å€¼æ–¹å¼ï¼Œç¨‹åºæŠ¥é”™è¿”å›é”™è¯¯é—®é¢˜ï¼Œé€šè¿‡åˆ¤æ–­ <strong>err!=nil</strong> æ¥å†³å®šç¨‹åºæ˜¯å¦ç»§ç»­æ‰§è¡Œæˆ–ç»ˆæ­¢è¯¥é€»è¾‘ã€‚å½“ç„¶ï¼Œå¦‚æœæ¥è§¦è¿‡<code>golang</code>é¡¹ç›®æ—¶ï¼Œä¼šå‘ç°ç¨‹åºä¸­å¤§é‡å……æ–¥ç€<code>if err!=nil</code>çš„ä»£ç ï¼Œå¯¹æ­¤ç½‘ä¸Šæœ‰å¯¹<code>if err!=nil</code>è¿›è¡Œäº†å¾ˆå¤šè®¨è®ºï¼Œå› ä¸ºè¿™ä¸ªä¸åœ¨æœ¬ç¯‡æ–‡ç« çš„èŒƒç•´ä¸­ï¼Œåœ¨æ­¤ä¸å¯¹å…¶è¿½æº¯ã€è®¨è®ºã€‚</p>
<h3><a class="header" href="#42-rust-é”™è¯¯å¤„ç†ç¤ºä¾‹" id="42-rust-é”™è¯¯å¤„ç†ç¤ºä¾‹">4.2 Rust é”™è¯¯å¤„ç†ç¤ºä¾‹</a></h3>
<p>å¯¹æ¯”äº†<code>golang</code>ä»£ç ï¼Œæˆ‘ä»¬å¯¹ç…§ä¸Šé¢çš„ä¾‹å­ï¼Œçœ‹ä¸‹åœ¨<code>Rust</code>ä¸­å¦‚ä½•ç¼–å†™è¿™æ®µç¨‹åºï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<pre><pre class="playground"><code class="language-rust">fn main() {
    let path = &quot;/tmp/dat&quot;;  //æ–‡ä»¶è·¯å¾„
    match read_file(path) { //åˆ¤æ–­æ–¹æ³•ç»“æœ
        Ok(file) =&gt; { println!(&quot;{}&quot;, file) } //OK ä»£è¡¨è¯»å–åˆ°æ–‡ä»¶å†…å®¹ï¼Œæ­£ç¡®æ‰“å°æ–‡ä»¶å†…å®¹
        Err(e) =&gt; { println!(&quot;{} {}&quot;, path, e) } //Errä»£è¡¨ç»“æœä¸å­˜åœ¨ï¼Œæ‰“å°é”™è¯¯ç»“æœ
    }
}

fn read_file(path: &amp;str) -&gt; Result&lt;String,std::io::Error&gt; { //Resultä½œä¸ºç»“æœè¿”å›å€¼
    std::fs::read_to_string(path) //è¯»å–æ–‡ä»¶å†…å®¹
}
</code></pre></pre>
<p>å½“å‰ï¼Œå› ä¸ºæˆ‘ä»¬ç»™çš„æ–‡ä»¶è·¯å¾„ä¸å­˜åœ¨ï¼Œç¨‹åºæŠ¥é”™ï¼Œæ‰“å°å†…å®¹å¦‚ä¸‹ï¼š</p>
<pre><code class="language-bash">No such file or directory (os error 2)
</code></pre>
<p>åœ¨<code>Rust</code>ä»£è¡¨ä¸­ï¼Œ<code>Result</code>æ˜¯ä¸€ä¸ª<code>enum</code>æšä¸¾å¯¹è±¡,éƒ¨åˆ†æºç å¦‚ä¸‹ï¼š</p>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>pub enum Result&lt;T, E&gt; {
    /// Contains the success value
    Ok(#[stable(feature = &quot;rust1&quot;, since = &quot;1.0.0&quot;)] T),

    /// Contains the error value
    Err(#[stable(feature = &quot;rust1&quot;, since = &quot;1.0.0&quot;)] E),
}
<span class="boring">}
</span></code></pre></pre>
<p>é€šå¸¸æˆ‘ä»¬ä½¿ç”¨<code>Result</code>çš„æšä¸¾å¯¹è±¡ä½œä¸ºç¨‹åºçš„è¿”å›å€¼ï¼Œé€šè¿‡<code>Result</code>æ¥åˆ¤æ–­å…¶ç»“æœï¼Œæˆ‘ä»¬ä½¿ç”¨<code>match</code>åŒ¹é…çš„æ–¹å¼æ¥è·å–<code>Result</code>çš„å†…å®¹ï¼Œåˆ¤æ–­æ­£å¸¸ï¼ˆOkï¼‰æˆ–é”™è¯¯(Err)ã€‚</p>
<p>æˆ–è®¸ï¼Œæˆ‘ä»¬å¤§è‡´å‘ä¸Šçœ‹å»ï¼Œ<code>golang</code>ä»£ç å’Œ<code>Rust</code>ä»£ç æ²¡æœ‰æœ¬è´¨åŒºåˆ«ï¼Œéƒ½æ˜¯é‡‡ç”¨è¿”å›å€¼æ–¹å¼ï¼Œç»™å‡ºç¨‹åºç»“æœã€‚ä¸‹é¢æˆ‘ä»¬å°±å¯¹æ¯”ä¸¤ç§è¯­è¨€è¯´è¯´ä¹‹é—´åŒºåˆ«ï¼š</p>
<ul>
<li><code>golang</code>é‡‡ç”¨å¤šè¿”å›å€¼æ–¹å¼ï¼Œæˆ‘ä»¬åœ¨æ‹¿åˆ°ç›®æ ‡ç»“æœæ—¶ï¼ˆä¸Šé¢æ˜¯æŒ‡æ–‡ä»¶å†…å®¹<em>file</em>ï¼‰ï¼Œéœ€è¦é¦–å…ˆå¯¹<code>err</code>åˆ¤æ–­æ˜¯å¦ä¸º<code>nil</code>,å¹¶ä¸”æˆ‘ä»¬åœ¨<code>return</code>æ—¶ï¼Œéœ€è¦ç»™<strong>å¤šè¿”å›å€¼</strong>åˆ†åˆ«èµ‹å€¼ï¼Œè°ƒç”¨æ—¶éœ€è¦å¯¹ <code>if err!=nil</code> åšç»“æœåˆ¤æ–­ã€‚</li>
<li><code>Rust</code>ä¸­é‡‡ç”¨<code>Result</code>çš„æšä¸¾å¯¹è±¡åšç»“æœè¿”å›ã€‚æšä¸¾çš„å¥½å¤„æ˜¯ï¼šå¤šé€‰ä¸€ã€‚å› ä¸º<code>Result</code>çš„æšä¸¾ç±»å‹ä¸º<code>Ok</code>å’Œ<code>Err</code>ï¼Œä½¿å¾—æˆ‘ä»¬æ¯æ¬¡åœ¨è¿”å›<code>Result</code>çš„ç»“æœæ—¶ï¼Œè¦ä¹ˆæ˜¯<code>Ok</code>,è¦ä¹ˆæ˜¯<code>Err</code>ã€‚å®ƒä¸éœ€è¦<code>return</code>ç»“æœåŒæ—¶ç»™ä¸¤ä¸ªå€¼èµ‹å€¼ï¼Œè¿™æ ·çš„æƒ…å†µåªä¼šå­˜åœ¨ä¸€ç§å¯èƒ½æ€§: <strong>Ok or Err</strong> ã€‚</li>
<li>golangçš„å‡½æ•°è°ƒç”¨éœ€è¦å¯¹ <code>if err!=nil</code>åšç»“æœåˆ¤æ–­ï¼Œå› ä¸ºè¿™æ®µä»£ç  åˆ¤æ–­æ˜¯<strong>æ‰‹åŠ¨é€»è¾‘</strong>ï¼Œå¾€å¾€æˆ‘ä»¬å¯èƒ½å› ä¸ºç–å¿½ï¼Œå¯¼è‡´è¿™æ®µé€»è¾‘ç¼ºå¤±ï¼Œç¼ºå°‘æ ¡éªŒã€‚å½“ç„¶ï¼Œæˆ‘ä»¬åœ¨ç¼–å†™ä»£ç æœŸé—´å¯ä»¥é€šè¿‡æŸäº›å·¥å…· <code>lint</code> æ‰«æå‡ºè¿™ç§æ½œåœ¨bugã€‚</li>
<li><code>Rust</code>çš„<code>match</code>åˆ¤æ–­æ˜¯è‡ªåŠ¨æ‰“å¼€ï¼Œå½“ç„¶ä½ ä¹Ÿå¯ä»¥é€‰æ‹©å¿½ç•¥å…¶ä¸­æŸä¸€ä¸ªæšä¸¾å€¼,æˆ‘ä»¬ä¸åœ¨æ­¤è¯´æ˜ã€‚</li>
</ul>
<p>å¯èƒ½æœ‰äººå‘ç°ï¼Œå¦‚æœæˆ‘æœ‰å¤šä¸ªå‡½æ•°ï¼Œéœ€è¦å¤šä¸ªå‡½æ•°çš„æ‰§è¡Œç»“æœï¼Œè¿™æ ·éœ€è¦<code>match</code>ä»£ç å¤šæ¬¡ï¼Œä»£ç ä¼šä¸ä¼šæ˜¯ä¸€å¨ä¸€å¨ï¼Œæ˜¾å¾—ä»£ç å¾ˆè‡ƒè‚¿ï¼Œéš¾çœ‹ã€‚æ˜¯çš„ï¼Œè¿™ä¸ªé—®é¢˜æå‡ºçš„çš„ç¡®æ˜¯æœ‰è¿™ç§é—®é¢˜ï¼Œä¸è¿‡è¿™ä¸ªåœ¨åé¢æˆ‘ä»¬è®²è§£çš„æ—¶å€™ï¼Œä¼šé€šè¿‡ç¨‹åºè¯­æ³•ç³–é¿å…å¤šæ¬¡<code>match</code>å¤šæ¬¡ç»“æœçš„é—®é¢˜ï¼Œä¸è¿‡æˆ‘ä»¬åœ¨æ­¤å…ˆä¸å™è¯´ï¼Œåé¢å°†æœ‰ä»‹ç»ã€‚</p>
<h2><a class="header" href="#5-rustä¸­çš„é”™è¯¯å¤„ç†" id="5-rustä¸­çš„é”™è¯¯å¤„ç†">5. Rustä¸­çš„é”™è¯¯å¤„ç†</a></h2>
<p>å‰é¢ä¸ç®¡æ˜¯<code>golang</code>è¿˜æ˜¯<code>Rust</code>é‡‡ç”¨<code>return</code>è¿”å›å€¼æ–¹å¼ï¼Œä¸¤è€…éƒ½æ˜¯ä¸ºäº†è§£å†³ç¨‹åºä¸­é”™è¯¯å¤„ç†çš„é—®é¢˜ã€‚å¥½äº†ï¼Œå‰é¢è¯´äº†è¿™ä¹ˆå¤šï¼Œæˆ‘ä»¬è¿˜æ˜¯å›å½’æ­£é¢˜ï¼šRustä¸­æ˜¯å¦‚ä½•å¯¹é”™è¯¯è¿›è¡Œå¤„ç†çš„ï¼Ÿ</p>
<p>è¦æƒ³ç»†è‡´äº†è§£<code>Rust</code>çš„é”™è¯¯å¤„ç†ï¼Œæˆ‘ä»¬éœ€è¦äº†è§£<code>std::error::Error</code>ï¼Œè¯¥traitçš„å†…éƒ¨æ–¹æ³•ï¼Œéƒ¨åˆ†ä»£ç å¦‚ä¸‹ï¼š
å‚è€ƒé“¾æ¥ï¼š<a href="https://doc.rust-lang.org/std/error/trait.Error.html">https://doc.rust-lang.org/std/error/trait.Error.html</a></p>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>pub trait Error: Debug + Display {

    fn description(&amp;self) -&gt; &amp;str {
        &quot;description() is deprecated; use Display&quot;
    }

    #[rustc_deprecated(since = &quot;1.33.0&quot;, reason = &quot;replaced by Error::source, which can support \
                                                   downcasting&quot;)]

    fn cause(&amp;self) -&gt; Option&lt;&amp;dyn Error&gt; {
        self.source()
    }

    fn source(&amp;self) -&gt; Option&lt;&amp;(dyn Error + 'static)&gt; { None }

    #[doc(hidden)]
    fn type_id(&amp;self, _: private::Internal) -&gt; TypeId where Self: 'static {
        TypeId::of::&lt;Self&gt;()
    }

    #[unstable(feature = &quot;backtrace&quot;, issue = &quot;53487&quot;)]
    fn backtrace(&amp;self) -&gt; Option&lt;&amp;Backtrace&gt; {
        None
    }
}
<span class="boring">}
</span></code></pre></pre>
<ul>
<li>
<p><code>description()</code>åœ¨æ–‡æ¡£ä»‹ç»ä¸­ï¼Œå°½ç®¡ä½¿ç”¨å®ƒä¸ä¼šå¯¼è‡´ç¼–è¯‘è­¦å‘Šï¼Œä½†æ–°ä»£ç åº”è¯¥å®ç°<code>impl Display</code> ï¼Œæ–°<code>impl</code>çš„å¯ä»¥çœç•¥ï¼Œä¸ç”¨å®ç°è¯¥æ–¹æ³•, è¦è·å–å­—ç¬¦ä¸²å½¢å¼çš„é”™è¯¯æè¿°ï¼Œè¯·ä½¿ç”¨<code>to_string()</code>ã€‚</p>
</li>
<li>
<p><code>cause()</code>åœ¨<strong>1.33.0</strong>è¢«æŠ›å¼ƒï¼Œå–è€Œä»£ä¹‹ä½¿ç”¨<code>source()</code>æ–¹æ³•ï¼Œæ–°<code>impl</code>çš„ä¸ç”¨å®ç°è¯¥æ–¹æ³•ã€‚</p>
</li>
<li>
<p><code>source()</code>æ­¤é”™è¯¯çš„ä½çº§æºï¼Œå¦‚æœå†…éƒ¨æœ‰é”™è¯¯ç±»å‹<code>Err</code>è¿”å›ï¼š<code>Some(e)</code>,å¦‚æœæ²¡æœ‰è¿”å›ï¼š<code>None</code>ã€‚</p>
<ul>
<li>å¦‚æœå½“å‰<code>Error</code>æ˜¯ä½çº§åˆ«çš„<code>Error</code>,å¹¶æ²¡æœ‰<strong>å­Error</strong>,éœ€è¦è¿”å›<code>None</code>ã€‚ä»‹äºå…¶æœ¬èº«é»˜è®¤æœ‰è¿”å›å€¼<code>None</code>ï¼Œå¯ä»¥<strong>ä¸è¦†ç›–</strong>è¯¥æ–¹æ³•ã€‚</li>
<li>å¦‚æœå½“å‰<code>Error</code>åŒ…å«<strong>å­Error</strong>,éœ€è¦è¿”å›<strong>å­Error</strong>ï¼š<code>Some(err)</code>,éœ€è¦<strong>è¦†ç›–</strong>è¯¥æ–¹æ³•ã€‚</li>
</ul>
</li>
<li>
<p><code>type_id()</code>è¯¥æ–¹æ³•è¢«éšè—ã€‚</p>
</li>
<li>
<p><code>backtrace()</code>è¿”å›å‘ç”Ÿæ­¤é”™è¯¯çš„å †æ ˆè¿½æº¯ï¼Œå› ä¸ºæ ‡è®°<code>unstable</code>ï¼Œåœ¨<code>Rust</code>çš„<code>stable</code>ç‰ˆæœ¬ä¸è¢«ä½¿ç”¨ã€‚</p>
</li>
<li>
<p>è‡ªå®šä¹‰çš„<code>Error</code>éœ€è¦<strong>impl std::fmt::Debug</strong>çš„trait,å½“ç„¶æˆ‘ä»¬åªéœ€è¦åœ¨é»˜è®¤å¯¹è±¡ä¸Šæ·»åŠ æ³¨è§£ï¼š<code>#[derive(Debug)]</code>å³å¯ã€‚</p>
</li>
</ul>
<p>æ€»ç»“ä¸€ä¸‹ï¼Œè‡ªå®šä¹‰ä¸€ä¸ª<code>error</code>éœ€è¦å®ç°å¦‚ä¸‹å‡ æ­¥ï¼š</p>
<ul>
<li>æ‰‹åŠ¨å®ç°impl <code>std::fmt::Display</code>çš„trait,å¹¶<strong>å®ç°</strong> <code>fmt(...)</code>æ–¹æ³•ã€‚</li>
<li>æ‰‹åŠ¨å®ç°impl <code>std::fmt::Debug</code>çš„<code>trait</code>ï¼Œä¸€èˆ¬ç›´æ¥æ·»åŠ æ³¨è§£å³å¯ï¼š<code>#[derive(Debug)]</code></li>
<li>æ‰‹åŠ¨å®ç°impl <code>std::error::Error</code>çš„<code>trait</code>,å¹¶æ ¹æ®è‡ªèº«<code>error</code>çº§åˆ«æ˜¯å¦<strong>è¦†ç›–</strong><code>std::error::Error</code>ä¸­çš„<code>source()</code>æ–¹æ³•ã€‚</li>
</ul>
<p>ä¸‹é¢æˆ‘ä»¬è‡ªå·±æ‰‹åŠ¨å®ç°ä¸‹<code>Rust</code>çš„<strong>è‡ªå®šä¹‰é”™è¯¯:CustomError</strong></p>
<pre><pre class="playground"><code class="language-rust">use std::error::Error;

///è‡ªå®šä¹‰ç±»å‹ Error,å®ç°std::fmt::Debugçš„trait
#[derive(Debug)]
struct CustomError {
    err: ChildError,
}

///å®ç°Displayçš„traitï¼Œå¹¶å®ç°fmtæ–¹æ³•
impl std::fmt::Display for CustomError {
    fn fmt(&amp;self, f: &amp;mut std::fmt::Formatter&lt;'_&gt;) -&gt; std::fmt::Result {
        write!(f, &quot;CustomError is here!&quot;)
    }
}

///å®ç°Errorçš„trait,å› ä¸ºæœ‰å­Error:ChildError,éœ€è¦è¦†ç›–source()æ–¹æ³•,è¿”å›Some(err)
impl std::error::Error for CustomError {
    fn source(&amp;self) -&gt; Option&lt;&amp;(dyn std::error::Error + 'static)&gt; {
        Some(&amp;self.err)
    }
}


///å­ç±»å‹ Error,å®ç°std::fmt::Debugçš„trait
#[derive(Debug)]
struct ChildError;

///å®ç°Displayçš„traitï¼Œå¹¶å®ç°fmtæ–¹æ³•
impl std::fmt::Display for ChildError {
    fn fmt(&amp;self, f: &amp;mut std::fmt::Formatter&lt;'_&gt;) -&gt; std::fmt::Result {
        write!(f, &quot;ChildError is here!&quot;)
    }
}

///å®ç°Errorçš„trait,å› ä¸ºæ²¡æœ‰å­Error,ä¸éœ€è¦è¦†ç›–source()æ–¹æ³•
impl std::error::Error for ChildError {}

///æ„å»ºä¸€ä¸ªResultçš„ç»“æœï¼Œè¿”å›è‡ªå®šä¹‰çš„error:CustomError
fn get_super_error() -&gt; Result&lt;(), CustomError&gt; {
    Err(CustomError { err: ChildError })
}

fn main() {
    match get_super_error() {
        Err(e) =&gt; {
            println!(&quot;Error: {}&quot;, e);
            println!(&quot;Caused by: {}&quot;, e.source().unwrap());
        }
        _ =&gt; println!(&quot;No error&quot;),
    }
}
</code></pre></pre>
<ul>
<li><code>ChildError</code>ä¸ºå­ç±»å‹<code>Error</code>,<strong>æ²¡æœ‰è¦†ç›–</strong><code>source()</code>æ–¹æ³•ï¼Œç©ºå®ç°äº†<code>std::error::Error</code></li>
<li><code>CustomError</code>æœ‰å­ç±»å‹<code>ChildError</code>,<strong>è¦†ç›–</strong>äº†<code>source()</code>,å¹¶è¿”å›äº†å­ç±»å‹Optionå€¼ï¼š<code>Some(&amp;self.err)</code></li>
</ul>
<p>è¿è¡Œæ‰§è¡Œç»“æœï¼Œæ˜¾ç¤ºå¦‚ä¸‹ï¼š</p>
<pre><code class="language-bash">Error: CustomError is here!
Caused by: ChildError is here!
</code></pre>
<p>è‡³æ­¤ï¼Œæˆ‘ä»¬å°±äº†è§£äº†å¦‚ä½•å®ç°<code>Rust</code>ä¸­<strong>è‡ªå®šä¹‰Error</strong>äº†ã€‚</p>
<h2><a class="header" href="#6-è‡ªå®šä¹‰errorè½¬æ¢from" id="6-è‡ªå®šä¹‰errorè½¬æ¢from">6. è‡ªå®šä¹‰Errorè½¬æ¢:From</a></h2>
<p>ä¸Šé¢æˆ‘ä»¬è¯´åˆ°ï¼Œå‡½æ•°è¿”å›<code>Result</code>çš„ç»“æœæ—¶ï¼Œéœ€è¦è·å–å‡½æ•°çš„è¿”å›å€¼æ˜¯æˆåŠŸ(Ok)è¿˜æ˜¯å¤±è´¥(Err)ï¼Œéœ€è¦ä½¿ç”¨<code>match</code>åŒ¹é…ï¼Œæˆ‘ä»¬çœ‹ä¸‹å¤šå‡½æ•°ä¹‹é—´è°ƒç”¨æ˜¯å¦‚ä½•è§£å†³è¿™ç±»é—®é¢˜çš„ï¼Ÿå‡è®¾æˆ‘ä»¬æœ‰ä¸ªåœºæ™¯ï¼š</p>
<ul>
<li>è¯»å–ä¸€æ–‡ä»¶</li>
<li>å°†æ–‡ä»¶å†…å®¹è½¬åŒ–ä¸º<code>UTF8</code>æ ¼å¼</li>
<li>å°†è½¬æ¢åæ ¼å¼å†…å®¹è½¬ä¸º<code>u32</code>çš„æ•°å­—ã€‚</li>
</ul>
<p>æ‰€ä»¥æˆ‘ä»¬æœ‰äº†ä¸‹é¢ä¸‰ä¸ªå‡½æ•°(çœç•¥éƒ¨åˆ†ä»£ç )ï¼š</p>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>...

///è¯»å–æ–‡ä»¶å†…å®¹
fn read_file(path: &amp;str) -&gt; Result&lt;String, std::io::Error&gt; {
    std::fs::read_to_string(path)
}

/// è½¬æ¢ä¸ºutf8å†…å®¹
fn to_utf8(v: &amp;[u8]) -&gt; Result&lt;&amp;str, std::str::Utf8Error&gt; {
    std::str::from_utf8(v)
}

/// è½¬åŒ–ä¸ºu32æ•°å­—
fn to_u32(v: &amp;str) -&gt; Result&lt;u32, std::num::ParseIntError&gt; {
    v.parse::&lt;u32&gt;()
}
<span class="boring">}
</span></code></pre></pre>
<p>æœ€ç»ˆï¼Œæˆ‘ä»¬å¾—åˆ°<code>u32</code>çš„æ•°å­—ï¼Œå¯¹äºè¯¥åœºæ™¯å¦‚ä½•ç»„ç»‡æˆ‘ä»¬ä»£ç å‘¢ï¼Ÿ</p>
<ul>
<li><code>unwrap()</code>ç›´æ¥æ‰“å¼€ä¸‰ä¸ªæ–¹æ³•ï¼Œå–å‡ºå€¼ã€‚è¿™ç§æ–¹å¼å¤ªæš´åŠ›ï¼Œå¹¶ä¸”ä¼šæœ‰<code>bug</code>,é€ æˆç¨‹åº<code>panic</code>,ä¸è¢«é‡‡çº³ã€‚</li>
<li><code>match</code>åŒ¹é…ï¼Œå¦‚ä½•è¿”å›OK,ç»§ç»­ä¸‹ä¸€æ­¥ï¼Œå¦åˆ™æŠ¥é”™ç»ˆæ­¢é€»è¾‘ï¼Œé‚£æˆ‘ä»¬è¯•è¯•ã€‚</li>
</ul>
<p>å‚è€ƒä»£ç å¦‚ä¸‹:</p>
<pre><pre class="playground"><code class="language-rust">fn main() {
    let path = &quot;./dat&quot;;
    match read_file(path) {
        Ok(v) =&gt; {
            match to_utf8(v.as_bytes()) {
                Ok(u) =&gt; {
                    match to_u32(u) {
                        Ok(t) =&gt; {
                            println!(&quot;num:{:?}&quot;, u);
                        }
                        Err(e) =&gt; {
                            println!(&quot;{} {}&quot;, path, e)
                        }
                    }
                }
                Err(e) =&gt; {
                    println!(&quot;{} {}&quot;, path, e)
                }
            }
        }
        Err(e) =&gt; {
            println!(&quot;{} {}&quot;, path, e)
        }
    }
}

///è¯»å–æ–‡ä»¶å†…å®¹
fn read_file(path: &amp;str) -&gt; Result&lt;String, std::io::Error&gt; {
    std::fs::read_to_string(path)
}

/// è½¬æ¢ä¸ºutf8å†…å®¹
fn to_utf8(v: &amp;[u8]) -&gt; Result&lt;&amp;str, std::str::Utf8Error&gt; {
    std::str::from_utf8(v)
}

/// è½¬åŒ–ä¸ºu32æ•°å­—
fn to_u32(v: &amp;str) -&gt; Result&lt;u32, std::num::ParseIntError&gt; {
    v.parse::&lt;u32&gt;()
}
</code></pre></pre>
<p>å¤©å•Šï¼Œè™½ç„¶æ˜¯å®ç°äº†ä¸Šé¢åœºæ™¯çš„éœ€æ±‚ï¼Œä½†æ˜¯ä»£ç çŠ¹å¦‚å ç½—æ±‰ï¼Œç¨‹åºç»“æ„è¶Šæ¥è¶Šæ·±å•Šï¼Œè¿™ä¸ªæ˜¯æˆ‘ä»¬æ²¡æ³•æ¥å—çš„ï¼<code>match</code>åŒ¹é…å¯¼è‡´ç¨‹åºå¦‚æ­¤<strong>ä¸å ªä¸€å‡»</strong>ã€‚é‚£ä¹ˆæœ‰æ²¡æœ‰ç¬¬ä¸‰ç§æ–¹æ³•å‘¢ï¼Ÿå½“ç„¶æ˜¯æœ‰çš„ï¼š<code>From</code>è½¬æ¢ã€‚</p>
<p>å‰é¢æˆ‘ä»¬è¯´åˆ°å¦‚ä½•<strong>è‡ªå®šä¹‰çš„Error</strong>,å¦‚ä½•æˆ‘ä»¬å°†ä¸Šé¢ä¸‰ä¸ª<code>error</code>æ”¶çº³åˆ°æˆ‘ä»¬<strong>è‡ªå®šä¹‰çš„Error</strong>ä¸­ï¼Œå°†å®ƒä»¬ä¸‰ä¸ª<code>Error</code>å˜æˆ<strong>è‡ªå®šä¹‰Error</strong>çš„<strong>å­Error</strong>ï¼Œè¿™æ ·æˆ‘ä»¬å¯¹å¤–çš„<code>Result</code>ç»Ÿä¸€è¿”å›<strong>è‡ªå®šä¹‰çš„Error</strong>ã€‚è¿™æ ·ç¨‹åºåº”è¯¥å¯ä»¥æ”¹å˜ç‚¹ä»€ä¹ˆï¼Œæˆ‘ä»¬æ¥è¯•è¯•å§ã€‚</p>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>#[derive(Debug)]
enum CustomError {
    ParseIntError(std::num::ParseIntError),
    Utf8Error(std::str::Utf8Error),
    IoError(std::io::Error),
}
impl std::error::Error for CustomError{
    fn source(&amp;self) -&gt; Option&lt;&amp;(dyn std::error::Error + 'static)&gt; {
        match &amp;self {
            CustomError::IoError(ref e) =&gt; Some(e),
            CustomError::Utf8Error(ref e) =&gt; Some(e),
            CustomError::ParseIntError(ref e) =&gt; Some(e),
        }
    }
}

impl Display for CustomError{
    fn fmt(&amp;self, f: &amp;mut Formatter&lt;'_&gt;) -&gt; std::fmt::Result {
        match &amp;self {
            CustomError::IoError(ref e) =&gt; e.fmt(f),
            CustomError::Utf8Error(ref e) =&gt; e.fmt(f),
            CustomError::ParseIntError(ref e) =&gt; e.fmt(f),
        }
    }
}

impl From&lt;ParseIntError&gt; for CustomError {
    fn from(s: std::num::ParseIntError) -&gt; Self {
        CustomError::ParseIntError(s)
    }
}

impl From&lt;IoError&gt; for CustomError {
    fn from(s: std::io::Error) -&gt; Self {
        CustomError::IoError(s)
    }
}

impl From&lt;Utf8Error&gt; for CustomError {
    fn from(s: std::str::Utf8Error) -&gt; Self {
        CustomError::Utf8Error(s)
    }
}
<span class="boring">}
</span></code></pre></pre>
<ul>
<li><code>CustomError</code>ä¸ºæˆ‘ä»¬å®ç°çš„<strong>è‡ªå®šä¹‰Error</strong></li>
<li><code>CustomError</code>æœ‰ä¸‰ä¸ª<strong>å­ç±»å‹Error</strong></li>
<li><code>CustomError</code>åˆ†åˆ«å®ç°äº†ä¸‰ä¸ª<strong>å­ç±»å‹Error</strong> <code>From</code>çš„trait,å°†å…¶ç±»å‹åŒ…è£…ä¸º<strong>è‡ªå®šä¹‰Error</strong>çš„å­ç±»å‹</li>
</ul>
<p>å¥½äº†ï¼Œæœ‰äº†è‡ªå®šä¹‰çš„<code>CustomError</code>ï¼Œé‚£æ€ä¹ˆä½¿ç”¨å‘¢? æˆ‘ä»¬çœ‹ä»£ç ï¼š</p>
<pre><pre class="playground"><code class="language-rust">use std::io::Error as IoError;
use std::str::Utf8Error;
use std::num::ParseIntError;
use std::fmt::{Display, Formatter};


fn main() -&gt; std::result::Result&lt;(),CustomError&gt;{
    let path = &quot;./dat&quot;;
    let v = read_file(path)?;
    let x = to_utf8(v.as_bytes())?;
    let u = to_u32(x)?;
    println!(&quot;num:{:?}&quot;,u);
    Ok(())
}

///è¯»å–æ–‡ä»¶å†…å®¹
fn read_file(path: &amp;str) -&gt; std::result::Result&lt;String, std::io::Error&gt; {
    std::fs::read_to_string(path)
}

/// è½¬æ¢ä¸ºutf8å†…å®¹
fn to_utf8(v: &amp;[u8]) -&gt; std::result::Result&lt;&amp;str, std::str::Utf8Error&gt; {
    std::str::from_utf8(v)
}

/// è½¬åŒ–ä¸ºu32æ•°å­—
fn to_u32(v: &amp;str) -&gt; std::result::Result&lt;u32, std::num::ParseIntError&gt; {
    v.parse::&lt;u32&gt;()
}


#[derive(Debug)]
enum CustomError {
    ParseIntError(std::num::ParseIntError),
    Utf8Error(std::str::Utf8Error),
    IoError(std::io::Error),
}
impl std::error::Error for CustomError{
    fn source(&amp;self) -&gt; Option&lt;&amp;(dyn std::error::Error + 'static)&gt; {
        match &amp;self {
            CustomError::IoError(ref e) =&gt; Some(e),
            CustomError::Utf8Error(ref e) =&gt; Some(e),
            CustomError::ParseIntError(ref e) =&gt; Some(e),
        }
    }
}

impl Display for CustomError{
    fn fmt(&amp;self, f: &amp;mut Formatter&lt;'_&gt;) -&gt; std::fmt::Result {
        match &amp;self {
            CustomError::IoError(ref e) =&gt; e.fmt(f),
            CustomError::Utf8Error(ref e) =&gt; e.fmt(f),
            CustomError::ParseIntError(ref e) =&gt; e.fmt(f),
        }
    }
}

impl From&lt;ParseIntError&gt; for CustomError {
    fn from(s: std::num::ParseIntError) -&gt; Self {
        CustomError::ParseIntError(s)
    }
}

impl From&lt;IoError&gt; for CustomError {
    fn from(s: std::io::Error) -&gt; Self {
        CustomError::IoError(s)
    }
}

impl From&lt;Utf8Error&gt; for CustomError {
    fn from(s: std::str::Utf8Error) -&gt; Self {
        CustomError::Utf8Error(s)
    }
}
</code></pre></pre>
<p>å…¶å®æˆ‘ä»¬ä¸»è¦å…³å¿ƒçš„æ˜¯è¿™æ®µä»£ç ï¼š</p>
<pre><pre class="playground"><code class="language-rust">fn main() -&gt; Result&lt;(),CustomError&gt;{
    let path = &quot;./dat&quot;;
    let v = read_file(path)?;
    let x = to_utf8(v.as_bytes())?;
    let u = to_u32(x)?;
    println!(&quot;num:{:?}&quot;,u);
    Ok(())
}
</code></pre></pre>
<p>æˆ‘ä»¬ä½¿ç”¨äº†<code>?</code>æ¥æ›¿ä»£åŸæ¥çš„<code>match</code>åŒ¹é…çš„æ–¹å¼ã€‚<code>?</code>ä½¿ç”¨é—®å·ä½œç”¨åœ¨å‡½æ•°çš„ç»“æŸï¼Œæ„æ€æ˜¯ï¼š</p>
<ul>
<li>ç¨‹åºæ¥å—äº†ä¸€ä¸ª<code>Result&lt;(),CustomError&gt;</code>è‡ªå®šä¹‰çš„é”™è¯¯ç±»å‹ã€‚</li>
<li>å½“å‰å¦‚æœå‡½æ•°ç»“æœé”™è¯¯ï¼Œç¨‹åºè‡ªåŠ¨æŠ›å‡º<code>Err</code>è‡ªèº«é”™è¯¯ç±»å‹ï¼Œå¹¶åŒ…å«ç›¸å…³è‡ªå·±ç±»å‹é”™è¯¯ä¿¡æ¯ï¼Œå› ä¸ºæˆ‘ä»¬åšäº†<code>From</code>è½¬æ¢çš„æ“ä½œï¼Œè¯¥å‡½æ•°çš„è‡ªèº«ç±»å‹é”™è¯¯ä¼šé€šè¿‡å®ç°çš„<code>From</code>æ“ä½œè‡ªåŠ¨è½¬åŒ–ä¸º<code>CustomError</code>çš„è‡ªå®šä¹‰ç±»å‹é”™è¯¯ã€‚</li>
<li>å½“å‰å¦‚æœå‡½æ•°ç»“æœæ­£ç¡®ï¼Œç»§ç»­ä¹‹åé€»è¾‘ï¼Œç›´åˆ°ç¨‹åºç»“æŸã€‚</li>
</ul>
<p>è¿™æ ·ï¼Œæˆ‘ä»¬é€šè¿‡<code>From</code>å’Œ<code>?</code>è§£å†³äº†ä¹‹å‰<code>match</code>åŒ¹é…ä»£ç å±‚çº§æ·±çš„é—®é¢˜ï¼Œå› ä¸ºè¿™ç§è½¬æ¢æ˜¯<strong>æ— æ„ŸçŸ¥</strong>çš„ï¼Œä½¿å¾—æˆ‘ä»¬åœ¨å¤„ç†å¥½é”™è¯¯ç±»å‹åï¼Œåªéœ€è¦å…³å¿ƒæˆ‘ä»¬çš„ç›®æ ‡å€¼å³å¯ï¼Œè¿™æ ·ä¸éœ€è¦æ˜¾ç¤ºå¯¹<code>Err(e)</code>çš„æ•°æ®å•ç‹¬å¤„ç†ï¼Œä½¿å¾—æˆ‘ä»¬åœ¨å‡½æ•°åæ·»åŠ <code>?</code>åï¼Œç¨‹åºä¸€åˆ‡éƒ½æ˜¯è‡ªåŠ¨äº†ã€‚</p>
<p>è¿˜è®°å¾—æˆ‘ä»¬ä¹‹å‰è®¨è®ºåœ¨å¯¹æ¯”<code>golang</code>çš„é”™è¯¯å¤„ç†æ—¶çš„:<code>if err!=nil</code>çš„é€»è¾‘äº†å—ï¼Œè¿™ç§å› ä¸ºç”¨äº†<code>?</code>è¯­æ³•ç³–ä½¿å¾—è¯¥æ®µåˆ¤æ–­å°†ä¸å†å­˜åœ¨ã€‚</p>
<p>å¦å¤–ï¼Œæˆ‘ä»¬è¿˜æ³¨æ„åˆ°ï¼Œ<code>Result</code>çš„ç»“æœå¯ä»¥ä½œç”¨åœ¨<code>main</code>å‡½æ•°ä¸Šï¼Œ</p>
<ul>
<li>æ˜¯çš„ï¼Œ<code>Result</code>çš„ç»“æœä¸ä»…èƒ½ä½œç”¨åœ¨<code>main</code>å‡½æ•°ä¸Š</li>
<li><code>Result</code>è¿˜å¯ä»¥ä½œç”¨åœ¨å•å…ƒæµ‹è¯•ä¸Šï¼Œè¿™å°±æ˜¯æˆ‘ä»¬æ–‡ä¸­åˆšå¼€å§‹æåˆ°çš„ï¼šå› ä¸ºæœ‰äº†<code>Result</code>çš„ä½œç”¨ï¼Œä½¿å¾—æˆ‘ä»¬åœ¨ç¨‹åºä¸­å‡ ä¹å¯ä»¥å®Œå…¨æ‘’å¼ƒ<code>unwrap()</code>çš„ä»£ç å—ï¼Œä½¿å¾—ç¨‹åºæ›´è½»ï¼Œå¤§å¤§å‡å°‘æ½œåœ¨é—®é¢˜ï¼Œç¨‹åºç»„ç»‡ç»“æ„æ›´åŠ æ¸…æ™°ã€‚</li>
</ul>
<p>ä¸‹é¢è¿™æ˜¯ä½œç”¨åœ¨å•å…ƒæµ‹è¯•ä¸Šçš„<code>Result</code>çš„ä»£ç ï¼š</p>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>...

#[cfg(test)]
mod tests {
    use super::*;

    #[test]
    fn test_get_num() -&gt; std::result::Result&lt;(), CustomError&gt; {
        let path = &quot;./dat&quot;;
        let v = read_file(path)?;
        let x = to_utf8(v.as_bytes())?;
        let u = to_u32(x)?;
        assert_eq!(u, 8);
        Ok(())
    }
}
<span class="boring">}
</span></code></pre></pre>
<h2><a class="header" href="#7-é‡å‘½åresult" id="7-é‡å‘½åresult">7. é‡å‘½åResult</a></h2>
<p>æˆ‘ä»¬åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œä¼šå¤§é‡ä½¿ç”¨å¦‚ä¸Šçš„<code>Result</code>ç»“æœï¼Œå¹¶ä¸”<code>Result</code>çš„<code>Err</code>ç±»å‹æ˜¯æˆ‘ä»¬<code>è‡ªå®šä¹‰é”™è¯¯</code>,å¯¼è‡´æˆ‘ä»¬å†™ç¨‹åºæ—¶ä¼šæ˜¾å¾—éå¸¸<strong>å•°å—¦</strong>ã€<strong>å†—ä½™</strong></p>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>///è¯»å–æ–‡ä»¶å†…å®¹
fn read_file(path: &amp;str) -&gt; std::result::Result&lt;String, CustomError&gt; {
    let val = std::fs::read_to_string(path)?;
    Ok(val)
}

/// è½¬æ¢ä¸ºutf8å†…å®¹
fn to_utf8(v: &amp;[u8]) -&gt; std::result::Result&lt;&amp;str, CustomError&gt; {
    let x = std::str::from_utf8(v)?;
    Ok(x)
}

/// è½¬åŒ–ä¸ºu32æ•°å­—
fn to_u32(v: &amp;str) -&gt; std::result::Result&lt;u32, CustomError&gt; {
    let i = v.parse::&lt;u32&gt;()?;
    Ok(i)
}
<span class="boring">}
</span></code></pre></pre>
<p>æˆ‘ä»¬çš„ç¨‹åºä¸­ï¼Œä¼šå¤§é‡å……æ–¥ç€è¿™ç§<strong>æ¨¡æ¿ä»£ç </strong>ï¼Œ<code>Rust</code>æœ¬èº«æ”¯æŒå¯¹ç±»å‹è‡ªå®šä¹‰ï¼Œä½¿å¾—æˆ‘ä»¬åªéœ€è¦é‡å‘½å<code>Result</code>å³å¯:</p>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>pub type IResult&lt;I&gt; = std::result::Result&lt;I, CustomError&gt;; ///è‡ªå®šä¹‰Resultç±»å‹ï¼šIResult
<span class="boring">}
</span></code></pre></pre>
<p>è¿™æ ·ï¼Œå‡¡æ˜¯ä½¿ç”¨çš„æ˜¯è‡ªå®šä¹‰ç±»å‹é”™è¯¯çš„<code>Result</code>éƒ½å¯ä»¥ä½¿ç”¨<code>IResult</code>æ¥æ›¿æ¢<code>std::result::Result</code>çš„ç±»å‹ï¼Œä½¿å¾—ç®€åŒ–ç¨‹åºï¼Œéšè—<code>Error</code>ç±»å‹åŠç»†èŠ‚ï¼Œå…³æ³¨ç›®æ ‡ä¸»ä½“ï¼Œä»£ç å¦‚ä¸‹ï¼š</p>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>///è¯»å–æ–‡ä»¶å†…å®¹
fn read_file(path: &amp;str) -&gt; IResult&lt;String&gt; {
    let val = std::fs::read_to_string(path)?;
    Ok(val)
}

/// è½¬æ¢ä¸ºutf8å†…å®¹
fn to_utf8(v: &amp;[u8]) -&gt; IResult&lt;&amp;str&gt; {
    let x = std::str::from_utf8(v)?;
    Ok(x)
}

/// è½¬åŒ–ä¸ºu32æ•°å­—
fn to_u32(v: &amp;str) -&gt; IResult&lt;u32&gt; {
    let i = v.parse::&lt;u32&gt;()?;
    Ok(i)
}
<span class="boring">}
</span></code></pre></pre>
<p>å°†<code>std::result::Result&lt;I, CustomError&gt;</code> æ›¿æ¢ä¸ºï¼š<code>IResult&lt;I&gt;</code>ç±»å‹</p>
<p>å½“ç„¶ï¼Œä¼šæœ‰äººæé—®ï¼Œå¦‚æœæ˜¯å¤šå‚æ•°ç±»å‹æ€ä¹ˆå¤„ç†å‘¢ï¼ŒåŒæ ·ï¼Œæˆ‘ä»¬åªéœ€å°†<code>OK</code>ç±»å‹å˜æˆ <strong>tuple</strong> <code>(I,O)</code>ç±»å‹çš„å¤šå‚æ•°æ•°æ®å³å¯ï¼Œå¤§æ¦‚è¿™æ ·ï¼š</p>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>pub type IResult&lt;I, O&gt; = std::result::Result&lt;(I, O), CustomError&gt;;
<span class="boring">}
</span></code></pre></pre>
<p>ä½¿ç”¨ä¹ŸåŠå…¶ç®€å•ï¼Œåªéœ€è¦è¿”å›ï¼š<strong>I</strong>,<strong>O</strong>çš„å…·ä½“ç±»å‹,ä¸¾ä¸ªç¤ºä¾‹ï¼š</p>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>fn foo() -&gt; IResult&lt;String, u32&gt; {
    Ok((String::from(&quot;bar&quot;), 32))
}
<span class="boring">}
</span></code></pre></pre>
<p>ä½¿ç”¨é‡å‘½åç±»å‹çš„<code>Result</code>ï¼Œä½¿å¾—æˆ‘ä»¬é”™è¯¯ç±»å‹ç»Ÿä¸€ï¼Œæ–¹ä¾¿å¤„ç†ã€‚åœ¨å®é™…é¡¹ç›®ä¸­ï¼Œå¯ä»¥å¤§é‡çœ‹åˆ°è¿™ç§ä¾‹å­çš„å­˜åœ¨ã€‚</p>
<h2><a class="header" href="#8-optionè½¬æ¢" id="8-optionè½¬æ¢">8. Optionè½¬æ¢</a></h2>
<p>æˆ‘ä»¬çŸ¥é“ï¼Œåœ¨<code>Rust</code>ä¸­ï¼Œéœ€è¦ä½¿ç”¨åˆ°<code>unwrap()</code>çš„æ–¹æ³•çš„å¯¹è±¡æœ‰<code>Result</code>,<code>Option</code>å¯¹è±¡ã€‚æˆ‘ä»¬çœ‹ä¸‹<code>Option</code>çš„å¤§è‡´ç»“æ„ï¼š</p>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>pub enum Option&lt;T&gt; {
    /// No value
    #[stable(feature = &quot;rust1&quot;, since = &quot;1.0.0&quot;)]
    None,
    /// Some value `T`
    #[stable(feature = &quot;rust1&quot;, since = &quot;1.0.0&quot;)]
    Some(#[stable(feature = &quot;rust1&quot;, since = &quot;1.0.0&quot;)] T),
}
<span class="boring">}
</span></code></pre></pre>
<p><code>Option</code>æœ¬èº«æ˜¯ä¸€ä¸ª<code>enum</code>å¯¹è±¡ï¼Œå¦‚æœè¯¥å‡½æ•°ï¼ˆæ–¹æ³•ï¼‰è°ƒç”¨ç»“æœå€¼æ²¡æœ‰å€¼ï¼Œè¿”å›<code>None</code>,åä¹‹æœ‰å€¼è¿”å›<code>Some(T)</code></p>
<p>å¦‚æœæˆ‘ä»¬æƒ³è·å–<code>Some(T)</code>ä¸­çš„<code>T</code>,æœ€ç›´æ¥çš„æ–¹å¼æ˜¯ï¼š<code>unwrap()</code>ã€‚æˆ‘ä»¬å‰é¢è¯´è¿‡ï¼Œä½¿ç”¨<code>unwrap()</code>çš„æ–¹å¼å¤ªè¿‡äºæš´åŠ›ï¼Œå¦‚æœå‡ºé”™ï¼Œç¨‹åºç›´æ¥<code>panic</code>ï¼Œè¿™æ˜¯æˆ‘ä»¬æœ€ä¸æ„¿æ„çœ‹åˆ°çš„ç»“æœã€‚</p>
<p>Ok,é‚£ä¹ˆæˆ‘ä»¬è¯•æƒ³ä¸‹, åˆ©ç”¨<code>Option</code>èƒ½ä½¿ç”¨<code>?</code>è¯­æ³•ç³–å—ï¼Ÿå¦‚æœèƒ½ç”¨<code>?</code>è½¬æ¢çš„è¯ï¼Œæ˜¯ä¸æ˜¯ä»£ç ç»“æ„å°±æ›´ç®€å•äº†å‘¢ï¼Ÿæˆ‘ä»¬å°è¯•ä¸‹,ä»£ç å¦‚ä¸‹ï¼š</p>
<pre><pre class="playground"><code class="language-rust">
#[derive(Debug)]
enum Error {
    OptionError(String),
}

impl std::error::Error for Error {}

impl std::fmt::Display for Error {
    fn fmt(&amp;self, f: &amp;mut std::fmt::Formatter&lt;'_&gt;) -&gt; std::fmt::Result {
        match &amp;self {
            Error::OptionError(ref e) =&gt; e.fmt(f),
        }
    }
}

pub type Result&lt;I&gt; = std::result::Result&lt;I, Error&gt;;


fn main() -&gt; Result&lt;()&gt; {
    let bar = foo(60)?;
    assert_eq!(&quot;bar&quot;, bar);
    Ok(())
}

fn foo(index: i32) -&gt; Option&lt;String&gt; {
    if index &gt; 60 {
        return Some(&quot;bar&quot;.to_string());
    }
    None
}
</code></pre></pre>
<p>æ‰§è¡Œç»“æœæŠ¥é”™ï¼š</p>
<pre><code class="language-bash">error[E0277]: `?` couldn't convert the error to `Error`
  --&gt; src/main.rs:22:22
   |
22 |     let bar = foo(60)?;
   |                      ^ the trait `std::convert::From&lt;std::option::NoneError&gt;` is not implemented for `Error`
   |
   = note: the question mark operation (`?`) implicitly performs a conversion on the error value using the `From` trait
   = note: required by `std::convert::From::from`

error: aborting due to previous error

For more information about this error, try `rustc --explain E0277`.
error: could not compile `hyper-define`.
</code></pre>
<p>æç¤ºå‘Šè¯‰æˆ‘ä»¬æ²¡æœ‰è½¬æ¢<code>std::convert::From&lt;std::option::NoneError&gt;</code>ï¼Œä½†æ˜¯<code>NoneError</code>æœ¬èº«æ˜¯<code>unstable</code>ï¼Œè¿™æ ·æˆ‘ä»¬æ²¡æ³•é€šè¿‡<code>From</code>è½¬æ¢ä¸º<strong>è‡ªå®šä¹‰Error</strong>ã€‚</p>
<p>æœ¬èº«ï¼Œåœ¨<code>Rust</code>çš„è®¾è®¡ä¸­ï¼Œå…³äº<code>Option</code>å’Œ<code>Result</code>å°±æ˜¯ä¸€å¯¹å­ªç”Ÿå…„å¼Ÿä¸€æ ·çš„å­˜åœ¨ï¼Œ<code>Option</code>çš„å­˜åœ¨å¯ä»¥å¿½ç•¥å¼‚å¸¸çš„ç»†èŠ‚ï¼Œç›´æ¥å…³æ³¨ç›®æ ‡ä¸»ä½“ã€‚å½“ç„¶ï¼Œ<code>Option</code>ä¹Ÿå¯ä»¥é€šè¿‡å†…ç½®çš„ç»„åˆå™¨<code>ok_or()</code>æ–¹æ³•å°†å…¶å˜æˆ<code>Result</code>ã€‚æˆ‘ä»¬å¤§è‡´çœ‹ä¸‹å®ç°ç»†èŠ‚ï¼š</p>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>impl&lt;T&gt; Option&lt;T&gt; {
    pub fn ok_or&lt;E&gt;(self, err: E) -&gt; Result&lt;T, E&gt; {
        match self {
            Some(v) =&gt; Ok(v),
            None =&gt; Err(err),
        }
    }
}    
<span class="boring">}
</span></code></pre></pre>
<p>è¿™é‡Œé€šè¿‡<code>ok_or()</code>æ–¹æ³•é€šè¿‡æ¥æ”¶ä¸€ä¸ª<strong>è‡ªå®šä¹‰Error</strong>ç±»å‹ï¼Œå°†ä¸€ä¸ª<code>Option</code>-&gt;<code>Result</code>ã€‚å¥½çš„ï¼Œå˜æˆ<code>Result</code>çš„ç±»å‹ï¼Œæˆ‘ä»¬å°±æ˜¯æˆ‘ä»¬ç†Ÿæ‚‰çš„é¢†åŸŸäº†ï¼Œè¿™æ ·å¤„ç†èµ·æ¥å°±å¾ˆçµæ´»ã€‚</p>
<p>å…³äº<code>Option</code>çš„å…¶ä»–å¤„ç†æ–¹å¼ï¼Œä¸åœ¨æ­¤å±•å¼€è§£å†³ï¼Œè¯¦ç»†çš„å¯çœ‹ä¸‹é¢é“¾æ¥ï¼š</p>
<p>å»¶ä¼¸é“¾æ¥ï¼š<a href="https://stackoverflow.com/questions/59568278/why-does-the-operator-report-the-error-the-trait-bound-noneerror-error-is-no">https://stackoverflow.com/questions/59568278/why-does-the-operator-report-the-error-the-trait-bound-noneerror-error-is-no</a></p>
<h2><a class="header" href="#9-é¿å…unwrap" id="9-é¿å…unwrap">9. é¿å…unwrap()</a></h2>
<p>æœ‰äººè‚¯å®šä¼šæœ‰ç–‘é—®ï¼Œå¦‚æœéœ€è¦åˆ¤æ–­çš„é€»è¾‘ï¼Œåˆä¸ç”¨<code>?</code>è¿™ç§æ“ä½œï¼Œæ€ä¹ˆå–å‡º<code>Option</code>æˆ–<code>Result</code>çš„æ•°æ®å‘¢ï¼Œå½“ç„¶ç‚¹å­æ€»æ¯”åŠæ³•å¤šï¼Œæˆ‘ä»¬æ¥çœ‹ä¸‹<code>Option</code>å¦‚ä½•åšçš„ï¼š</p>
<pre><pre class="playground"><code class="language-rust">fn main() {
    if let Some(v) = opt_val(60) {
        println!(&quot;{}&quot;, v);
    }
}

fn opt_val(num: i32) -&gt; Option&lt;String&gt; {
    if num &gt;= 60 {
        return Some(&quot;foo bar&quot;.to_string());
    }
    None
}
</code></pre></pre>
<p>æ˜¯çš„ï¼Œæˆ‘ä»¬ä½¿ç”¨<code>if let Some(v)</code>çš„æ–¹å¼å–å‡ºå€¼ï¼Œå½“å‰<code>else</code>çš„é€»è¾‘å°±å¯èƒ½éœ€è¦è‡ªå·±å¤„ç†äº†ã€‚å½“ç„¶ï¼Œ<code>Option</code>å¯ä»¥è¿™æ ·åšï¼Œ<code>Result</code>ä¹Ÿä¸€å®šå¯ä»¥:</p>
<pre><pre class="playground"><code class="language-rust">fn main() {
    if let Ok(v) = read_file(&quot;./dat&quot;) {
        println!(&quot;{}&quot;, v);
    }
}

fn read_file(path: &amp;str) -&gt; Result&lt;String, std::io::Error&gt; {
    std::fs::read_to_string(path)
}
</code></pre></pre>
<p>åªä¸è¿‡ï¼Œåœ¨å¤„ç†<code>Result</code>çš„åˆ¤æ–­æ—¶ï¼Œä½¿ç”¨çš„æ˜¯<code>if let Ok(v)</code>ï¼Œè¿™ä¸ªå’Œ<code>Option</code>çš„<code>if let Some(v)</code>æœ‰æ‰€ä¸åŒã€‚</p>
<p>åˆ°è¿™é‡Œï¼Œ<code>unwrap()</code>çš„ä»£ç ç‰‡åœ¨é¡¹ç›®ä¸­åº”è¯¥å¯ä»¥è§„é¿äº†ã€‚è¡¥å……ä¸‹ï¼Œè¿™é‡Œå¼ºè°ƒäº†å‡ æ¬¡è§„é¿ï¼Œå°±å¦‚å‰æ‰€è¨€ï¼š<strong>å›¢é˜Ÿé£æ ¼ç»Ÿä¸€ï¼Œæ–¹ä¾¿ç®¡ç†ä»£ç ï¼Œæ¶ˆé™¤æ½œåœ¨å±æœº</strong>ã€‚</p>
<h2><a class="header" href="#10-è‡ªå®šä¹‰erroråŒçº§è½¬æ¢" id="10-è‡ªå®šä¹‰erroråŒçº§è½¬æ¢">10. è‡ªå®šä¹‰ErroråŒçº§è½¬æ¢</a></h2>
<p>æˆ‘ä»¬åœ¨é¡¹ç›®ä¸­ï¼Œä¸€ä¸ªå‡½æ•°ï¼ˆæ–¹æ³•ï¼‰å†…éƒ¨ä¼šæœ‰å¤šæ¬¡<code>Result</code>çš„ç»“æœåˆ¤æ–­ï¼š<code>?</code>,å‡è®¾æˆ‘ä»¬è‡ªå®šä¹‰çš„å…¨å±€Erroråç§°ä¸ºï¼š<code>GlobalError</code>ã€‚</p>
<p>è¿™æ—¶å€™ï¼Œå¦‚æœå…¨å±€æœ‰ä¸€ä¸ª<code>Error</code>å¯èƒ½å°±ä¼šå‡ºç°å¦‚ä¸‹é”™è¯¯ï¼š</p>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>std::convert::From&lt;error::GlobalError&lt;A&gt;&gt;` is not implemented for `error::GlobalError&lt;B&gt;
<span class="boring">}
</span></code></pre></pre>
<p>æ„æ€æ˜¯ï¼šæˆ‘ä»¬è‡ªå®šä¹‰çš„<code>GlobalError</code>æ²¡æœ‰é€šè¿‡From&lt;GlobalError<T>&gt;è½¬æ¢æˆ‘ä»¬è‡ªå·±è‡ªå®šä¹‰çš„<code>GlobalError</code>ï¼Œé‚£è¿™æ ·ï¼Œå°±ç­‰äº<strong>è‡ªå·±è½¬æ¢è‡ªå·±</strong>ã€‚æ³¨æ„ï¼š</p>
<ul>
<li>ç¬¬ä¸€ï¼šè¿™æ˜¯æˆ‘ä»¬ä¸æœŸæœ›è¿™æ ·åšçš„ã€‚</li>
<li>ç¬¬äºŒï¼šé‡åˆ°è¿™ç§è‡ªå·±è½¬æ¢è‡ªå·±çš„<code>T</code>ç±»å‹å¾ˆå¤šï¼Œæˆ‘ä»¬ä¸å¯èƒ½æŠŠå‡ºç°çš„<code>T</code>ç±»å‹é€šé€šå®ç°ä¸€éã€‚
è¿™æ—¶å€™ï¼Œæˆ‘ä»¬è€ƒè™‘è‡ªå®šä¹‰å¦ä¸€ä¸ªErroräº†ï¼Œå‡è®¾æˆ‘ä»¬è§†ä¸ºï¼š<code>InnnerError</code>,æˆ‘ä»¬å…¨å±€çš„Errorå–åä¸ºï¼š<code>GlobalError</code>ï¼Œæˆ‘ä»¬åœ¨é‡åˆ°ä¸Šé¢é”™è¯¯æ—¶ï¼Œè¿”å›<code>Result&lt;T,InnerError&gt;</code>,è¿™æ ·æˆ‘ä»¬é‡åˆ°<code>Result&lt;T,GlobalError&gt;</code>æ—¶ï¼Œåªéœ€è¦é€šè¿‡<code>From&lt;T&gt;</code>è½¬æ¢å³å¯ï¼Œä»£ç ç¤ºä¾‹å¦‚ä¸‹ï¼š</li>
</ul>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>impl From&lt;InnerError&gt; for GlobalError {
    fn from(s: InnerError) -&gt; Self {
        Error::new(ErrorKind::InnerError(e))
    }
}
<span class="boring">}
</span></code></pre></pre>
<p>ä¸Šé¢è¯´çš„è¿™ç§æƒ…å†µï¼Œå¯èƒ½ä¼šåœ¨é¡¹ç›®ä¸­å‡ºç°<strong>å¤šä¸ªè‡ªå®šä¹‰Error</strong>,å‡ºç°è¿™ç§æƒ…å†µæ—¶ï¼Œå­˜åœ¨å¤šä¸ªä¸åŒErrorçš„<code>std::result::Result&lt;T,Err&gt;</code>çš„è¿”å›ã€‚è¿™é‡Œçš„<code>Err</code>å°±å¯ä»¥æ ¹æ®æˆ‘ä»¬ä¸šåŠ¡ç°çŠ¶åˆ†åˆ«åå›ä¸åŒç±»å‹äº†ã€‚æœ€ç»ˆï¼Œåªè¦å®ç°äº†<code>From&lt;T&gt;</code>çš„<code>trait</code>å¯è½¬åŒ–ä¸ºæœ€ç»ˆæœŸæœ›ç»“æœã€‚</p>
<h2><a class="header" href="#11-errorå¸¸è§å¼€æºåº“" id="11-errorå¸¸è§å¼€æºåº“">11. Errorå¸¸è§å¼€æºåº“</a></h2>
<p>å¥½äº†ï¼Œä»‹ç»åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬åº”è¯¥æœ‰äº†éå¸¸æ¸…æ™°çš„è®¤çŸ¥ï¼šå…³äºå¦‚ä½•å¤„ç†<code>Rust</code>çš„é”™è¯¯å¤„ç†é—®é¢˜äº†ã€‚ä½†æ˜¯æƒ³æƒ³ä¸Šé¢çš„è¿™äº›é€»è¾‘å¤šæ•°æ˜¯æ¨¡æ¿ä»£ç ï¼Œæˆ‘ä»¬åœ¨å®é™…ä¸­ï¼Œå¤§å¯ä¸å¿…è¿™æ ·ã€‚è¯´åˆ°è¿™é‡Œï¼Œå¼€æºç¤¾åŒºä¹Ÿæœ‰äº†å¾ˆå¤šå¯¹é”™è¯¯å¤„ç†åº“çš„æ”¯æŒï¼Œä¸‹é¢åˆ—ä¸¾äº†ä¸€äº›ï¼š</p>
<ul>
<li><a href="https://github.com/rust-lang-nursery/failure">https://github.com/rust-lang-nursery/failure</a></li>
<li><a href="https://github.com/rust-lang-nursery/error-chain">https://github.com/rust-lang-nursery/error-chain</a></li>
<li><a href="https://github.com/dtolnay/anyhow">https://github.com/dtolnay/anyhow</a></li>
<li><a href="https://github.com/dtolnay/thiserror">https://github.com/dtolnay/thiserror</a></li>
<li><a href="https://github.com/tailhook/quick-error">https://github.com/tailhook/quick-error</a></li>
</ul>
<h2><a class="header" href="#12-å‚è€ƒé“¾æ¥" id="12-å‚è€ƒé“¾æ¥">12. å‚è€ƒé“¾æ¥</a></h2>
<ul>
<li><a href="https://blog.burntsushi.net/rust-error-handling/">https://blog.burntsushi.net/rust-error-handling/</a></li>
<li><a href="https://doc.rust-lang.org/edition-guide/rust-2018/error-handling-and-panics/question-mark-in-main-and-tests.html">https://doc.rust-lang.org/edition-guide/rust-2018/error-handling-and-panics/question-mark-in-main-and-tests.html</a></li>
<li><a href="https://doc.rust-lang.org/rust-by-example/error/result.html">https://doc.rust-lang.org/rust-by-example/error/result.html</a></li>
<li><a href="https://doc.rust-lang.org/rust-by-example/error.html">https://doc.rust-lang.org/rust-by-example/error.html</a></li>
<li><a href="https://github.com/rust-lang/rust/issues/43301">https://github.com/rust-lang/rust/issues/43301</a></li>
</ul>
<h2><a class="header" href="#13-é”™è¯¯å¤„ç†å®æˆ˜" id="13-é”™è¯¯å¤„ç†å®æˆ˜">13 é”™è¯¯å¤„ç†å®æˆ˜</a></h2>
<p>è¿™ä¸ªä¾‹å­ä»‹ç»äº†å¦‚ä½•åœ¨<code>https://github.com/Geal/nom</code>ä¸­å¤„ç†é”™è¯¯ï¼Œè¿™é‡Œå°±ä¸å±•å¼€ä»‹ç»äº†ï¼Œæœ‰å…´è¶£çš„å¯è‡ªè¡Œé˜…è¯»ä»£ç ã€‚</p>
<p>è¯¦ç»†è§é“¾æ¥ï¼š<a href="https://github.com/baoyachi/rust-error-handle/blob/master/src/demo_nom_error_handle.rs">https://github.com/baoyachi/rust-error-handle/blob/master/src/demo_nom_error_handle.rs</a></p>
<h2><a class="header" href="#14-æ€»ç»“" id="14-æ€»ç»“">14. æ€»ç»“</a></h2>
<p>å¥½äº†ï¼Œç»è¿‡ä¸Šé¢çš„é•¿ç¯‡å¤§è®ºï¼Œä¸çŸ¥é“å¤§å®¶æ˜¯å¦æ˜ç™½å¦‚ä½•è‡ªå®šä¹‰å¤„ç†Errorå‘¢äº†ã€‚å¤§å®¶ç°åœ¨å¸¦ç€ä¹‹å‰çš„å·²æœ‰çš„é—®é¢˜æˆ–å›°æƒ‘ï¼Œèµ¶ç´§å®æˆ˜ä¸‹<code>Rust</code>çš„é”™è¯¯å¤„ç†å§ï¼Œå¤§å®¶æœ‰ç–‘é—®æˆ–è€…é—®é¢˜éƒ½å¯ä»¥ç•™è¨€æˆ‘ï¼Œå¸Œæœ›è¿™ç¯‡æ–‡ç« å¯¹ä½ æœ‰å¸®åŠ©ã€‚</p>
<p>æ–‡ä¸­ä»£ç è¯¦è§:<a href="https://github.com/baoyachi/rust-handle-error/tree/master/src">https://github.com/baoyachi/rust-handle-error/tree/master/src</a></p>
<p>åŸæ–‡åœ°å€:<a href="https://github.com/baoyachi/rust-error-handle">https://github.com/baoyachi/rust-error-handle</a></p>
<h1><a class="header" href="#rust-cratesç§æœ‰åŒ–éƒ¨ç½²æŒ‡å—private-alternative-registry" id="rust-cratesç§æœ‰åŒ–éƒ¨ç½²æŒ‡å—private-alternative-registry">Rust cratesç§æœ‰åŒ–éƒ¨ç½²æŒ‡å—(private alternative registry)</a></h1>
<p>åœ¨<code>Rust</code>ä¸­,ä¸€èˆ¬ä½¿ç”¨å¤–éƒ¨ä¾èµ–çš„åº“éƒ¨ç½²åœ¨<a href="https://crates.io/">https://crates.io/</a>ã€‚æˆ‘ä»¬ç›´æ¥åœ¨<code>Cargo.toml</code>çš„<code>dependencies</code>é…ç½®å³å¯ï¼Œåˆ—å¦‚ä¸‹é…ç½®ï¼š</p>
<pre><code class="language-toml">...
[dependencies]
rand = &quot;0.7.3&quot;
serde = &quot;1.0&quot;
serde_derive = &quot;1.0&quot;
serde_json = &quot;1.0&quot;
lazy_static = &quot;1.4.0&quot;
...
</code></pre>
<p>å¦‚æœç»†å¿ƒçš„åŒå­¦ä¼šå‘ç°ï¼Œå¦‚æœ<code>rand</code>åº“æ›´æ–°åˆ°<code>rand = &quot;0.7.4&quot;</code>æ—¶ï¼Œæˆ‘ä»¬æ‰§è¡Œ<code>cargo update</code>ï¼Œ<code>Cargo.lock</code>ä¼šè‡ªåŠ¨æ›´æ–°<code>rand</code>åˆ°æœ€æ–°çš„<code>0.7.4</code>ç‰ˆæœ¬ã€‚è¿™ä¸»è¦æ˜¯<code>Rust</code>é‡‡ç”¨äº†<a href="https://semver.org/">è¯­ä¹‰åŒ–ç‰ˆæœ¬</a>ã€‚</p>
<p>ä½†æ˜¯è¿™æ ·çš„ä¾èµ–å¯¹äº<code>Rust</code>æä¾›çš„<code>crates.io</code>æ˜¯æ²¡é—®é¢˜çš„ï¼Œé¢å¯¹ç§æœ‰åŒ–çš„é¡¹ç›®ï¼Œå³ä¸èƒ½å…±äº«åˆ°å…¬å¼€çš„<code>crates</code>ä¸Šï¼Œåˆæƒ³åšåˆ°ç§æœ‰ä¾èµ–ï¼Œé—®é¢˜å°±æš´éœ²äº†ã€‚</p>
<h2><a class="header" href="#2cargoç§æœ‰åŒ–gitä¾èµ–" id="2cargoç§æœ‰åŒ–gitä¾èµ–">2.cargoç§æœ‰åŒ–gitä¾èµ–</a></h2>
<p>ä¸€èˆ¬æ¥è¯´ï¼Œä¼ä¸šçš„ç§æœ‰ä»£ç ï¼Œéƒ½ä¾èµ–äºç§æœ‰gitä»“åº“ã€‚ç¿»è¿‡<code>cargo</code>çš„æ–‡æ¡£æ—¶ï¼Œè¿™é‡Œå°±æåˆ°äº†ä¸€ä¸ªå…³äºgitç§æœ‰åŒ–ä¾èµ–çš„é—®é¢˜ï¼Œè¯¦è§é“¾æ¥ï¼š</p>
<ul>
<li><a href="https://doc.rust-lang.org/cargo/reference/specifying-dependencies.html#specifying-dependencies-from-git-repositories">https://doc.rust-lang.org/cargo/reference/specifying-dependencies.html#specifying-dependencies-from-git-repositories</a></li>
</ul>
<p>è¿™é‡Œçš„gitç§æœ‰åŒ–ä¸å¤–ä¹è¿™å‡ ç§ä¾èµ–ï¼š<code>branch</code>ä¾èµ–ï¼Œ<code>tag</code>ä¾èµ–ï¼Œ<code>commit-id</code>ä¾èµ–ï¼Œåˆ—å¦‚ä¸‹é…ç½®ï¼š</p>
<pre><code class="language-toml">[dependencies]
rand = { git = &quot;https://github.com/rust-lang-nursery/rand&quot;, branch = &quot;master&quot; }
rand = { git = &quot;https://github.com/rust-lang-nursery/rand&quot;, tag = &quot;0.2.2&quot; }
rand = { git = &quot;https://github.com/rust-lang-nursery/rand&quot;, rev = &quot;e2112c4&quot; }
</code></pre>
<p>çœ‹åˆ°è¿™é‡Œï¼Œæˆ‘ä»¬å°±æƒ³åˆ°äº†æ‰æœ‰ç§æœ‰åŒ–<code>git</code>æ–¹å¼ä¾èµ–ï¼Œæˆ‘ä»¬ä¹Ÿè¿™æ ·åšäº†ã€‚æ¥ä¸‹æ¥é—®é¢˜ä¾¿å‘ç”Ÿäº†ã€‚</p>
<ul>
<li>2.1 åœ¨é¡¹ç›®ä¸­ï¼Œæˆ‘ä»¬å®šä¹‰äº†ä¸€äº›å…¬å…±ä¾èµ–çš„ç»“æ„ï¼š<code>hula_common</code>ç§æœ‰ä»“åº“ã€‚</li>
<li>2.2 <code>A</code>é¡¹ç›®(lib)ä½¿ç”¨äº†<code>hula_common</code>çš„ä»“åº“ï¼Œä¾èµ–<code>tag=&quot;0.1.5&quot;</code>å¦‚ä¸‹</li>
</ul>
<pre><code class="language-toml">hula_common = { package = &quot;hula_common&quot;, git = &quot;ssh://git@git.baoyachi.com/hula/hula_common.git&quot; , tag = &quot;0.1.5&quot; }
</code></pre>
<ul>
<li>2.3. <code>B</code>é¡¹ç›®(lib)ä¹Ÿä½¿ç”¨äº†<code>hula_common</code>çš„ä»“åº“ï¼Œä¾èµ–<code>tag=&quot;0.1.4&quot;</code>å¦‚ä¸‹</li>
</ul>
<pre><code class="language-toml">hula_common  = { package = &quot;hula_common&quot;, git   = &quot;ssh://git@git.baoyachi.com/hula/hula_common.git&quot; , tag = &quot;0.1.4&quot; }
</code></pre>
<ul>
<li>
<p>2.4 <code>A</code>libå’Œ<code>B</code>libéƒ½åŒæ—¶ä¾èµ–äº†<code>hula_common</code>ï¼Œä¸¤è€…åŒºåˆ«å°±æ˜¯å¼•ç”¨çš„gitçš„<code>tag</code>ç‰ˆæœ¬ä¸åŒã€‚</p>
</li>
<li>
<p>2.5 åœ¨ä¸»ç¨‹åºçš„<code>project</code>åç§°æ˜¯<code>fuzz</code>ä¸­,<code>fuzz</code>åŒæ—¶ä¾èµ–äº†<code>A</code>,<code>B</code>,<code>hula_common</code>ç­‰ç§æœ‰<code>lib</code>,å¤§è‡´å¦‚ä¸‹ï¼š</p>
</li>
</ul>
<pre><code class="language-toml">...
[dependencies]
serde_derive = &quot;1.0.111&quot;
serde = &quot;1.0.111&quot;
serde_json = &quot;1.0.53&quot;
...

hula_common = { package = &quot;hula_common&quot;, git = &quot;ssh://git@git.baoyachi.com/hula/hula_common.git&quot; , tag = &quot;0.1.5&quot; }
B = { package = &quot;B&quot;, git = &quot;ssh://git@git.baoyachi.com/hula/B.git&quot; , tag = &quot;0.3.2&quot; }
A = { package = &quot;A&quot;, git = &quot;ssh://git@git.baoyachi.com/hula/A.git&quot; , tag = &quot;0.5.7&quot; }
...
</code></pre>
<ul>
<li>2.6 å½“æˆ‘ä»¬ç¼–è¯‘<code>fuzz</code>æ—¶ï¼Œå±…ç„¶ç¼–è¯‘æŠ¥é”™?</li>
</ul>
<pre><code class="language-bash">error[E0308]: mismatched types
   --&gt; src/common/query.rs:196:23
    |
196 |         let items = self.query(pos, key)?;
    |                                ^^^^^ expected struct `hula_common::query::Container`, found struct `hula_common::query::Container`
    |
    = note: expected reference `&amp;hula_common::query::Container`
               found reference `&amp;hula_common::query::Container`
    = note: perhaps two different versions of crate `hula_common` are being used?
</code></pre>
<p>å¤§è‡´æ„æ€æ˜¯ï¼š<code>hula_common</code>ä½¿ç”¨äº†ä¸åŒç‰ˆæœ¬(different versions),å¯¼è‡´ç¼–è¯‘æŠ¥é”™ã€‚è¿™ä¸ªå¾ˆè®©äººè¯¡å¼‚ï¼š
å¯¹äºä¸Šé¢æåˆ°çš„<code>rand</code>åœ¨<code>crates.io</code>çš„ä¾èµ–ï¼Œå¦‚æœç‰ˆæœ¬æ›´æ–°ï¼Œä¼šè‡ªåŠ¨æ›´æ–°ï¼Œåè€Œå› ä¸º<code>git</code>çš„<code>tag</code>å·®å¼‚ï¼ŒRustè®¤ä¸ºå¯¼å…¥çš„<code>crate</code>ä¸ä¸€è‡´ï¼Œè¿™ä¸ªé—®é¢˜çº ç»“äº†æˆ‘å¾ˆä¹…ã€‚</p>
<p>ä¸€æ–¹é¢ï¼Œæƒ³è¦è®©æ‰€æœ‰åº“ä¾èµ–åŒä¸€ä¸ª<code>tag</code>ï¼Œè¿™ä¸ªç€å®è®©äººå¤´ç–¼ã€‚<code>hula_common</code>çš„å®šä¹‰ç”±<code>0.1.4</code>-&gt;<code>0.1.5</code>,å¯èƒ½åªæ˜¯é’ˆå¯¹<code>B</code>é¡¹ç›®å¢åŠ çš„å±€éƒ¨å­—æ®µï¼Œè€Œä¸ä¼šå½±å“<code>A</code>é¡¹ç›®çš„ç¼–è¯‘ã€‚æŒ‰ç†è¯´ï¼Œè‹¥<code>Rust</code>éµå¾ª<a href="https://semver.org/">https://semver.org</a>è¯­ä¹‰åŒ–ç‰ˆæœ¬çš„ä¾èµ–ï¼Œåº”è¯¥æ˜¯å¯ä»¥æ­£å¸¸ç¼–è¯‘è¿‡çš„ï¼Œä½†ç°å®æ˜¯failedã€‚</p>
<p>å¦‚æœç†Ÿæ‚‰<code>go mod</code>çš„ä¾èµ–ï¼Œå°±ä¼šå‘ç°ï¼Œä¸Šé¢è¿™ç§ä¾èµ–æ–¹å¼ï¼Œåœ¨<code>go mod</code>ç¼–è¯‘æ—¶ï¼Œæ˜¯å®Œå…¨okçš„ã€‚åŒæ ·çš„é—®é¢˜ï¼Œå¯¹äº<code>Rust</code>æ¥è¯´ï¼Œä¸ºä½•ç¼–è¯‘å¤±è´¥ï¼Ÿå› æ­¤ï¼Œå¸¦ç€é—®é¢˜ï¼Œå¯»æ±‚å®˜æ–¹çš„å›å¤ï¼Œæœ‰äººä¾¿ç»™äº†åé¦ˆ,åŸè¯å¦‚ä¸‹ï¼š</p>
<pre><code class="language-bash">Cargo has no way of knowing that two different tags point to compatible projects. If you want a shared dependency on a git project it has to be the same commit to be compatible. Cargo will happily build both tags into the same project, but it will not treat types from one as the same as types from the other.

...
git tags are arbitrary strings, we have no way to know if &quot;master&quot; and &quot;dev&quot; are sember compatible. crates.io versions are semver versions, so we can determine that &quot;^0.1.4&quot; can resolve to 0.1.5. Note that if you have &quot;=0.1.4&quot; as a requirement on crates.io you would also get an error.

Your company may want to create a private alternative registry.
</code></pre>
<p>å¤§è‡´æ„æ€æ˜¯ï¼šCargoæ— æ³•çŸ¥é“ä¸¤ä¸ªä¸åŒçš„tagæŒ‡å‘å…¼å®¹çš„é¡¹ç›®ã€‚å¦‚æœè¦å…±äº«å¯¹gité¡¹ç›®çš„ä¾èµ–ï¼Œåˆ™å¿…é¡»å…·æœ‰ç›¸åŒçš„commitæ‰èƒ½å…¼å®¹ã€‚æœ¬èº«gitçš„<code>tag</code>å¯ä»¥æ˜¯ä»»æ„å­—ç¬¦ä¸²ï¼Œ<code>Cargo</code>æ— æ³•çŸ¥é“<code>master</code>å’Œ<code>dev</code>æ˜¯å¦ä¸<code>semver versions</code>çš„ç‰ˆæœ¬å…¼å®¹ã€‚</p>
<p>å¦‚æœçœŸçš„è¦ä½¿ç”¨<code>semver versions</code>è®©<code>Cargo</code>è®¤è¯†ï¼Œéœ€è¦åˆ›å»ºç±»ä¼¼<code>crates.io</code>çš„ç§æœ‰<code>private alternative registry</code>ã€‚</p>
<h2><a class="header" href="#3-alternative-registry" id="3-alternative-registry">3 alternative registry</a></h2>
<p>åœ¨<code>Rust 1.34.0</code>çš„ç‰ˆæœ¬ä¸­ï¼Œæ”¯æŒäº†<code>Alternative cargo registries</code>ã€‚ä»€ä¹ˆæ„æ€ï¼Ÿé€šå¸¸æˆ‘ä»¬ä¸ä»…ä»…ä¾èµ–<code>crates.io</code>ä¸Šçš„ä»£ç ï¼Œåœ¨ä¼ä¸šæˆ–å…¶ä»–ç»„ç»‡ä¸­ï¼Œå­˜åœ¨å¤§é‡ç§æœ‰ä»“åº“ä»£ç ï¼ˆgitlabï¼‰,ä½¿å¾—æˆ‘ä»¬åœ¨å¯¹äº<code>Cargo</code>ä¾èµ–æ—¶ï¼Œæ—¢éœ€è¦ä¾èµ–<code>crates.io</code>ï¼Œåˆè¦æœ‰å…¶ä»–çš„<code>registry</code>ä¾èµ–ï¼Œ<code>1.34.0</code>çš„ç‰ˆæœ¬å¼€å§‹æ”¯æŒäº†è¯¥ç‰¹æ€§ã€‚å¤§è‡´é…ç½®å¦‚ä¸‹ï¼š</p>
<ul>
<li>
<p>3.1 åˆ›å»ºåœ¨gitä¸Šçš„<code>crate index</code>çš„å­˜å‚¨ä»“åº“
å‡è®¾æˆ‘ä»¬åœ¨gitlabä¸Šåˆ›å»ºäº†ä¸€ä¸ªå…³äºç§æœ‰çš„<code>crates</code>çš„å­˜å‚¨ä»“åº“ï¼š<code>https://git.baoyachi.com/hula/crates-index.git</code>ã€‚</p>
</li>
<li>
<p>3.2 æ‰¾åˆ°<code>.cargo</code>çš„æ ¹ç›®å½•ï¼Œåˆ›å»º<code>config.toml</code>æ–‡ä»¶ï¼ˆ./cargo/config.tomlï¼‰,åœ¨<code>config.toml</code>é…ç½®è‡ªå·±çš„<code>registry</code>,å‡è®¾æˆ‘ä»¬å‘½å:<code>git-baoyachi</code>, å¹¶åšå¦‚ä¸‹é…ç½®ï¼š</p>
</li>
</ul>
<pre><code class="language-toml">[registries]
git-baoyachi = { index = &quot;https://git.baoyachi.com/hula/crates-index&quot; }
</code></pre>
<p>æˆ–æ˜¯è¿™æ ·ï¼š</p>
<pre><code class="language-toml">[registries.git-baoyachi]
index = &quot;https://git.baoyachi.com/hula/crates-index&quot;
</code></pre>
<p><strong>ä¸Šé¢ä¸¤è€…æ˜¯ç­‰ä»·çš„ï¼ŒäºŒé€‰ä¸€å³å¯ã€‚</strong></p>
<p>æ³¨æ„ï¼šå‡è®¾ç§æœ‰ä»“åº“æ˜¯<code>gitlab</code>,è¿™é‡Œçš„<code>index</code>çš„é“¾æ¥å³ä¸ºgitlabçš„é“¾æ¥ï¼Œå³ä¸ºï¼š<code>https://git.baoyachi.com/hula/crates-index.git</code>ã€‚è¿™é‡Œæˆ‘ä»¬ä½¿ç”¨çš„æ˜¯<code>http</code>æˆ–<code>https</code>çš„æ–¹å¼ï¼Œå¦‚æœæ˜¯sshçš„è¯ï¼Œåˆ—é…ç½®å¦‚ä¸‹ï¼š</p>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>[registries.git-baoyachi]
index = &quot;ssh://git@git.baoyachi.com/hula/crates-index.git&quot;
<span class="boring">}
</span></code></pre></pre>
<p>æˆ–æ˜¯è¿™æ ·ï¼š</p>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>[registries]
git-baoyachi = {index = &quot;ssh://git@git.baoyachi.com/hula/crates-index.git&quot;}
<span class="boring">}
</span></code></pre></pre>
<p>è¯·æ³¨æ„:<strong>ä»gitlabçš„å…‹éš†æŒ‰é’®å¤åˆ¶/ç²˜è´´æ—¶ï¼ŒSSHç½‘å€æœ‰ä¸¤ä¸ªä¸»è¦åŒºåˆ«ï¼šå¿…é¡»åœ¨å‰é¢æ·»åŠ ssh://ï¼Œå¹¶å°†gi.xxx.comä¹‹åçš„<code>:</code>æ›´æ”¹ä¸º<code>/</code></strong></p>
<ul>
<li>3.3 é…ç½®crateså¤‡ç”¨æ³¨å†Œè¡¨çš„æœåŠ¡
å¦‚æœè¯»äº†æ–‡æ¡£çš„ï¼Œç»†å¿ƒçš„åŒå­¦ä¼šå‘ç°ï¼Œæ–‡æ¡£ä¸­åªæ˜¯ä»‹ç»äº†æ€ä¹ˆé…ç½®ï¼Œå› ä¸ºå¹¶æ²¡æœ‰å‘Šè¯‰æ€ä¹ˆæ­å»ºç§æœ‰çš„<code>alternative registry</code>ã€‚å¥½åœ¨å¼€æºç¤¾åŒºæä¾›äº†ç§æœ‰åŒ–çš„cratesçš„æ³¨å†ŒæœåŠ¡:<a href="https://github.com/Hirevo/alexandrie">https://github.com/Hirevo/alexandrie</a></li>
</ul>
<p>æˆ‘ä»¬è·Ÿç€æ–‡æ¡£æ‰‹å†Œæ‰‹åŠ¨æ­ä¸€ä¸ªè¯•è¯•ï¼š<a href="https://hirevo.github.io/alexandrie/installation-script.html">https://hirevo.github.io/alexandrie/installation-script.html</a></p>
<ul>
<li>3.3.1 åˆ›å»ºå®‰è£…é…ç½®è„šæœ¬:<code>alexandrie.sh</code></li>
</ul>
<pre><code class="language-bash">#!/bin/bash

# function to run when an error is encountered
function setup_error {
    echo &quot;-------- An error occurred during configuration --------&quot;
    exit 1
}

# exit on error
trap 'setup_error' ERR

# directory to clone Alexandrie into:
ALEXANDRIE_DIR=&quot;$2&quot;;

# URL to the crate index repository.
CRATE_INDEX_GIT_URL=&quot;$1&quot;;


while ! git ls-remote -h $CRATE_INDEX_GIT_URL; do
    read -p 'CRATE_INDEX_GIT_URL: ' CRATE_INDEX_GIT_URL;
done

if ! cargo -V; then
    echo;
    echo &quot;In order to build an instance of Alexandrie, you need to have Rust installed on your system&quot;;
    echo &quot;You can learn how to install Rust on your system on the official Rust website:&quot;;
    echo &quot;https://www.rust-lang.org/tools/install&quot;;
    echo;
    ! :;    # trigger error trap
fi

if [ -d &quot;$ALEXANDRIE_DIR&quot; ]; then
    echo
    echo &quot;'$ALEXANDRIE_DIR' (ALEXANDRIE_DIR) is an existing directory, pulling latest changes ...&quot;;
    cd &quot;$ALEXANDRIE_DIR&quot;;
    git pull;
    echo &quot;Changes have been pulled successfully !&quot;;
    echo;
else
    echo;
    echo &quot;Cloning Alexandrie in '$ALEXANDRIE_DIR' ...&quot;;
    git clone https://github.com/Hirevo/alexandrie.git &quot;$ALEXANDRIE_DIR&quot;;
    cd &quot;$ALEXANDRIE_DIR&quot;;
    echo &quot;Successfully cloned Alexandrie !&quot;;
    echo;
fi

echo &quot;Building Alexandrie (using the default features)...&quot;;
echo &quot;(keep in mind that the default features may not fit your use-case, be sure to review them before deplying it to production)&quot;;
cargo build -p alexandrie;
echo &quot;Alexandrie has been built successfully !&quot;;

# create the directory serving as the storage of crate archives.
mkdir -p crate-storage;

# setup the crate index.
if [ -d crate-index ]; then
    echo;
    echo &quot;'${ALEXANDRIE_DIR}/crate-index' is an existing directory, pulling latest changes ...&quot;;
    cd crate-index;
    git pull;
    echo &quot;Changes have been pulled successfully !&quot;;
    echo;
else
    echo;
    echo &quot;Cloning crate index in '${ALEXANDRIE_DIR}/crate-index' ...&quot;;
    git clone &quot;$CRATE_INDEX_GIT_URL&quot; crate-index;
    cd crate-index;
    echo &quot;Successfully cloned the crate index !&quot;;
    echo;
fi

# configure the crate index
if [ ! -f config.json ]; then
    echo &quot;The crate index does not have a 'config.json' file.&quot;;
    echo &quot;Creating an initial one (please also review it before deploying the registry in production) ...&quot;
    cat &gt; config.json &lt;&lt; EOF;
{
    &quot;dl&quot;: &quot;http://$(hostname):3000/api/v1/crates/{crate}/{version}/download&quot;,
    &quot;api&quot;: &quot;http://$(hostname):3000&quot;,
    &quot;allowed-registries&quot;: [&quot;https://github.com/rust-lang/crates.io-index&quot;]
}
EOF
    git add config.json;
    git commit -m 'Added `config.json`';
    git push -u origin master;
    echo &quot;Initial 'config.json' file has been created and pushed to the crate index !&quot;;
    echo;
fi

echo &quot;Alexandrie should be good to go for an initial run.&quot;;
echo &quot;You can start the Alexandrie instance by:&quot;;
echo &quot;  - navigating to '${ALEXANDRIE_DIR}'&quot;;
echo &quot;  - tweaking the 'alexandrie.toml' file&quot;;
echo &quot;  - run `./target/debug/alexandrie`&quot;;
echo;

</code></pre>
<p>æ³¨æ„ï¼šè¯¥è„šæœ¬éœ€è¦ä¸¤ä¸ªå‚æ•°ï¼š</p>
<ul>
<li>
<p><code>ALEXANDRIE_DIR</code>: æœ¬åœ°çš„è·¯å¾„,åˆ—å¦‚ï¼š/home/baoyachi/alexandrie</p>
</li>
<li>
<p><code>CRATE_INDEX_GIT_URL</code>:å°±æ˜¯æˆ‘ä»¬åœ¨3.1åˆ›å»ºçš„<code>crats index</code>çš„gitåœ°å€ï¼Œå¦‚ï¼š<code>ssh://git@git.baoyachi.com/hula/crates-index.git</code></p>
</li>
<li>
<p>3.3.2 æ‰§è¡Œè„šæœ¬</p>
</li>
</ul>
<pre><code class="language-bash">sh alexandrie.sh ssh://git@git.baoyachi.com/hula/crates-index.git /home/baoyachi/alexandrie
</code></pre>
<p>è§£é‡Šä¸‹è¯¥è„šæœ¬åšçš„å·¥ä½œï¼šclone <code>CRATE_INDEX_GIT_URL</code>ä»“åº“ï¼Œåˆ›å»º<code>config.json</code>,é…ç½®å¦‚ä¸‹ï¼š</p>
<pre><code class="language-json">{
    &quot;dl&quot;: &quot;http://{{host:port}}/api/v1/crates/{crate}/{version}/download&quot;,
    &quot;api&quot;: &quot;http://{{host:port}}&quot;,
    &quot;allowed-registries&quot;: [&quot;https://github.com/rust-lang/crates.io-index&quot;]
}
</code></pre>
<p>è¿™é‡Œçš„<code>host</code>,<code>port</code>æœ€ç»ˆæ¢æˆçº¿ä¸Šéƒ¨ç½²çš„æœåŠ¡ã€‚</p>
<ul>
<li>3.3.3 å¯åŠ¨æœåŠ¡</li>
</ul>
<pre><code class="language-bash">cd /home/baoyachi/alexandrie
./target/debug/alexandrie alexandrie.toml
</code></pre>
<p>æœåŠ¡å¯åŠ¨å®Œæˆï¼Œå¤§è‡´è¾“å‡ºå¦‚ä¸‹ï¼š</p>
<pre><code class="language-bash">âœ  alexandrie git:(master) ./target/debug/alexandrie alexandrie.toml
Jul 26 22:23:36.382 INFO running database migrations, version: 0.1.0
Jul 26 22:23:36.383 INFO setting up request logger middleware, version: 0.1.0
Jul 26 22:23:36.383 INFO setting up cookie middleware, version: 0.1.0
Jul 26 22:23:36.384 INFO setting up authentication middleware, version: 0.1.0
Jul 26 22:23:36.384 INFO mounting '/', version: 0.1.0
Jul 26 22:23:36.384 INFO mounting '/me', version: 0.1.0
Jul 26 22:23:36.384 INFO mounting '/search', version: 0.1.0
Jul 26 22:23:36.385 INFO mounting '/most-downloaded', version: 0.1.0
Jul 26 22:23:36.385 INFO mounting '/last-updated', version: 0.1.0
Jul 26 22:23:36.385 INFO mounting '/crates/:crate', version: 0.1.0
Jul 26 22:23:36.386 INFO mounting '/account/login', version: 0.1.0
Jul 26 22:23:36.386 INFO mounting '/account/logout', version: 0.1.0
Jul 26 22:23:36.386 INFO mounting '/account/register', version: 0.1.0
...
...
Jul 26 22:23:36.391 INFO mounting '/api/v1/crates/:name', version: 0.1.0
Jul 26 22:23:36.391 INFO mounting '/api/v1/crates/:name/owners', version: 0.1.0
Jul 26 22:23:36.392 INFO mounting '/api/v1/crates/:name/:version/yank', version: 0.1.0
Jul 26 22:23:36.392 INFO mounting '/api/v1/crates/:name/:version/unyank', version: 0.1.0
Jul 26 22:23:36.392 INFO mounting '/api/v1/crates/:name/:version/download', version: 0.1.0
Jul 26 22:23:36.392 INFO listening on 127.0.0.1:3000, version: 0.1.0
Jul 26 22:23:36.392 INFO Server listening on http://127.0.0.1:3000, version: 0.1.0
</code></pre>
<ul>
<li>3.4 æ‰§è¡Œcargo login
åœ¨æ‰§è¡Œ<code>cargo login --registry=my-registry</code>,è¿™é‡Œçš„<code>my-registry</code>å³ä¸º3.2é…ç½®çš„indexåç§°ï¼Œå‡è®¾ä¸ºï¼š<code>git-baoyachi</code>,åˆ™æ‰§è¡Œ</li>
</ul>
<pre><code class="language-bash">âœ cargo login --registry=git-baoyachi
please visit http://localhost:3000/me and paste the API Token below
2506b7bd94dfc708b755d5399
       Login token for `git-baoyachi` saved
</code></pre>
<p>æç¤ºæˆ‘ä»¬éœ€è¦è¾“å…¥token,æˆ‘ä»¬åœ¨3.3.3å¯åŠ¨çš„æœ¬åœ°æœåŠ¡ï¼Œè®¿é—®http://localhost:3000/meï¼Œç³»ç»Ÿæç¤ºæˆ‘ä»¬æ³¨å†Œï¼Œç”Ÿæˆtokenï¼Œå¤§è‡´å¦‚ä¸‹ï¼š
<img src="Rust/./alexandrie_get_token.png" alt="token" /></p>
<ul>
<li>3.5 åˆ›å»ºï¼Œå‘å¸ƒç§æœ‰<code>crates</code>åº“
å‡è®¾æˆ‘ä»¬åˆ›å»ºäº†åº“ï¼Œ<code>cargo new hula-common --lib</code>,æˆ‘ä»¬å°†è¯¥åº“å‘å¸ƒåˆ°æŒ‡å®šçš„ç§æœ‰gitä»“åº“ä¸­ï¼Œå¦‚3.1æ‰€è¿°ï¼Œæ‰§è¡Œå¦‚ä¸‹å‘½ä»¤,è¿™é‡Œçš„<code>my-registry</code>å³ä¸º3.2é…ç½®çš„indexåç§°ï¼Œå‡è®¾ä¸ºï¼š<code>git-baoyachi</code>,åˆ™æ‰§è¡Œ</li>
</ul>
<pre><code class="language-bash">cargo publish --registry=git-baoyachi
</code></pre>
<p>å¦‚æœloginæˆåŠŸçš„è¯ï¼Œæ‰§è¡Œç»“æœå¤§è‡´å¦‚ä¸‹ï¼š</p>
<pre><code class="language-bash">âœ  cargo publish --registry=git-baoyachi 
    Updating `ssh://git@git.baoyachi.com/hula/crates-index.git` index
warning: manifest has no description, license, license-file, documentation, homepage or repository.
See https://doc.rust-lang.org/cargo/reference/manifest.html#package-metadata for more info.
   Packaging hula-common v1.0.2 (/home/baoyachi/git_project/crates-index/hula-common)
   Verifying hula-common v1.0.2 (/home/baoyachi/git_project/crates-index/hula-common)
   Compiling hula-common v1.0.2 (/home/baoyachi/git_project/crates-index/hula-common/target/package/h2-1.0.2)
    Finished dev [unoptimized + debuginfo] target(s) in 1.18s
   Uploading hula-common v1.0.2 (/home/baoyachi/git_project/crates-index/hula-common)
âœ     
</code></pre>
<p>æ³¨æ„ï¼Œ<code>alexandrie</code>ä¼šæ£€æŸ¥<code>Cargo.toml</code>çš„ç‰ˆæœ¬<code>version = &quot;1.0.3&quot;</code>ï¼Œå¦‚æœåŒä¸€ç‰ˆæœ¬publishå¤šæ¬¡ï¼Œä¼šæŠ¥å¦‚ä¸‹é”™è¯¯ï¼š</p>
<pre><code class="language-bash">error: failed to get a 200 OK response, got 500
headers:
	HTTP/1.1 100 Continue

	HTTP/1.1 500 Internal Server Error

	content-length: 0

	date: Sun, 26 Jul 2020 10:42:46 GMT

body:
</code></pre>
<p>æˆ‘ä»¬éœ€è¦æ£€æŸ¥å½“å‰åº“çš„ç‰ˆæœ¬å·æ˜¯å¦é‡å¤å³å¯ã€‚å¦‚æœæŒ‰ä¸Šæ­¥éª¤æ‰§è¡Œokçš„è¯ï¼Œ<code>alexandrie</code>ä¼šè‡ªåŠ¨pushæˆ‘ä»¬ä»“åº“çš„ç§æœ‰<code>crates</code>çš„gitä»“åº“ï¼Œæ›´æ–°å½“å‰publishåº“çš„ä¿¡æ¯ã€‚</p>
<h2><a class="header" href="#4-ä½¿ç”¨ç§æœ‰cratesä¾èµ–" id="4-ä½¿ç”¨ç§æœ‰cratesä¾èµ–">4. ä½¿ç”¨ç§æœ‰cratesä¾èµ–</a></h2>
<p>æˆ‘ä»¬åœ¨ç¬¬ä¸€ç« èŠ‚ä¹Ÿè¯¦ç»†æè¿°äº†ï¼Œå¦‚æœä½¿ç”¨gitçš„<code>branch</code>æˆ–<code>tag</code>ä¾èµ–æ—¶ï¼Œä¼šå‡ºç°å½“å‰<code>perhaps two different versions of crate</code>çš„é—®é¢˜ï¼Œæˆ‘ä»¬èŠ±äº†å¤§é‡ç¯‡å¹…è®²è§£å¦‚æœä½¿ç”¨åˆ›å»ºå’Œå‘å¸ƒç§åº“ï¼Œå°±æ˜¯ä¸ºäº†è§£å†³gitä¾èµ–çš„é—®é¢˜ã€‚é‚£ä¹ˆï¼Œç­”æ¡ˆæ¥äº†ï¼Œæˆ‘ä»¬åªéœ€è¦ä¿®æ”¹<code>Cargo.toml</code>çš„<code>dependencies</code>ä¾èµ–å³å¯ï¼Œæˆ‘ä»¬è¿˜æ˜¯ä»¥ç¬¬ä¸€ç« åˆ—å­ä¸¾ä¾‹é…ç½®ï¼š</p>
<pre><code class="language-toml">...
[dependencies]
serde_derive = &quot;1.0.111&quot;
serde = &quot;1.0.111&quot;
serde_json = &quot;1.0.53&quot;
...

hula_common = { version=&quot;0.1.4&quot;, registry = &quot;git-baoyachi&quot; }
B = { package = &quot;B&quot;, version=&quot;0.3.2&quot;, registry = &quot;git-baoyachi&quot; }
A = { package = &quot;A&quot;, version=&quot;0.5.7&quot;, registry = &quot;git-baoyachi&quot; }
...
</code></pre>
<p>æˆ‘ä»¬åªéœ€è¦åœ¨ä¾èµ–åé¢ï¼ŒæŒ‡å®šè‡ªå®šä¹‰çš„<code>registry</code>é…ç½®å³å¯ã€‚è¿™æ ·ï¼Œå³ä½¿<code>hula_common</code>å‡çº§åˆ°<code>version=&quot;0.1.5&quot;</code>,æˆ‘ä»¬æ‰§è¡Œ<code>cargo update</code>ä¹Ÿå¯ä»¥è®©æ­£å¸¸ç¼–è¯‘ã€‚</p>
<h2><a class="header" href="#5æ€»ç»“" id="5æ€»ç»“">5.æ€»ç»“</a></h2>
<p>æˆ‘ä»¬æƒ³å»ºç«‹ç§æœ‰çš„<code>crates</code>çš„é…ç½®ï¼Œå¤§è‡´éœ€è¦å¦‚ä¸‹å‡ æ­¥ï¼š</p>
<ul>
<li>åˆ›å»ºå­˜å‚¨<code>crates-index</code>çš„ç§æœ‰ä»“åº“</li>
<li>éƒ¨ç½² <a href="https://github.com/Hirevo/alexandrie">alexandrie</a>çš„ç§æœ‰æœåŠ¡ï¼Œç»‘å®šåŸŸå</li>
<li>å»ºç«‹è®¤è¯ï¼Œè·å–<code>cargo login</code>çš„<code>token</code></li>
<li>å¯¹åº”<code>lib</code>æ‰§è¡Œ<code>cargo publish</code></li>
<li>ä½¿ç”¨ä¾èµ–ï¼Œé…ç½®æŒ‡å®š<code>registry</code></li>
</ul>
<h2><a class="header" href="#å†™åœ¨æœ€å" id="å†™åœ¨æœ€å">å†™åœ¨æœ€å</a></h2>
<p>å…³äºè¿™éƒ¨åˆ†çš„é—®é¢˜ï¼ŒRustçš„ç›¸å…³èµ„æ–™åœ¨ä¸­æ–‡ç¤¾åŒºï¼Œç½‘ä¸Šçš„æŸ¥åˆ°è¿˜æ˜¯è¾ƒå°‘ï¼Œä¸€æ–¹é¢æ˜¯è¯­è¨€æ™®åŠåº¦çš„åŸå› ï¼Œå¦ä¸€æ–¹é¢æ˜¯ç¤¾åŒºåˆ†äº«çš„å°‘ã€‚ä½†è¿™å¹¶ä¸å¦¨ç¢æˆ‘ä»¬è§£å†³é—®é¢˜ã€‚å¯¹äºå…ˆåƒèƒèŸ¹çš„ï¼Œæ€»ä¼šç£•ç£•ç»Šç»Šï¼Œåœ¨è¿™è§£å†³é—®é¢˜çš„è¿‡ç¨‹ä¸­ï¼Œå¯¹äºé—®é¢˜çš„åˆ¨æ ¹ï¼Œå’Œå¼€æºç¤¾åŒºäº¤æµï¼Œæ²Ÿé€šä»¥åŠåä½œä¸Šçš„æ€ç»´æ–¹å¼è¿˜æ˜¯æœ‰ä¸å°‘æ”¶è·ã€‚</p>
<h2><a class="header" href="#å‚è€ƒé“¾æ¥" id="å‚è€ƒé“¾æ¥">å‚è€ƒé“¾æ¥</a></h2>
<ul>
<li><a href="https://github.com/rust-lang/cargo/issues/8536">https://github.com/rust-lang/cargo/issues/8536</a></li>
<li><a href="https://doc.rust-lang.org/cargo/reference/registries.html#using-an-alternate-registry">https://doc.rust-lang.org/cargo/reference/registries.html#using-an-alternate-registry</a></li>
<li><a href="https://github.com/Hirevo/alexandrie/issues/75">https://github.com/Hirevo/alexandrie/issues/75</a></li>
<li><a href="https://blog.rust-lang.org/2019/04/11/Rust-1.34.0.html">https://blog.rust-lang.org/2019/04/11/Rust-1.34.0.html</a></li>
<li><a href="https://github.com/rust-lang/rfcs/blob/master/text/2141-alternative-registries.md">https://github.com/rust-lang/rfcs/blob/master/text/2141-alternative-registries.md</a></li>
</ul>
<h1><a class="header" href="#rustä»£ç ä¼˜åŒ–-é—­åŒ…æƒ°æ€§æ±‚å€¼" id="rustä»£ç ä¼˜åŒ–-é—­åŒ…æƒ°æ€§æ±‚å€¼">Rustä»£ç ä¼˜åŒ–-é—­åŒ…æƒ°æ€§æ±‚å€¼</a></h1>
<p><img src="https://github.com/baoyachi/baoyachi.github.io/blob/master/png/rust/code_practice.jpg?raw=true" alt="code_practice" /></p>
<h2><a class="header" href="#èƒŒæ™¯" id="èƒŒæ™¯">èƒŒæ™¯</a></h2>
<p>å†™ä»£ç æ—¶ï¼Œç»å¸¸ä¼šé‡åˆ°ä»<code>Option</code>æˆ–<code>Result</code>ä¸­å–å€¼å¾—é—®é¢˜ï¼Œä¸ºäº†é¿å…ä½¿ç”¨<code>unwrap()</code>,ä½¿ç”¨äº†<code>if let Some(xxx)</code>æˆ–<code>if let Ok(xxx)</code>
çš„ä»£ç è¡¨è¾¾ã€‚ä¹‹å‰çš„æ–‡ç« ä¹Ÿä»‹ç»äº†è¿™ç§å†™æ³•ï¼Œæƒ¯ç”¨æ³•ä¹Ÿè‡ªä»¥ä¸ºä¹ ä»¥ä¸ºå¸¸ã€‚</p>
<ul>
<li>1.æœ€è¿‘ä¸€æ¬¡ä»£ç åœ¨å‘PRæ—¶ï¼Œä¸‹é¢è¿™æ®µä»£ç ä½œè€…å»ºè®®ï¼Œåˆæœ‰äº†å†™æ”¶è·ï¼š</li>
</ul>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>struct Message(usize);

fn get_msg(msg: &amp;Option&lt;Message&gt;) -&gt; String {
    let mut rep_msg = &quot;Ok&quot;.to_string();
    if let Some(msg) = msg {
        rep_msg = format!(&quot;{}&quot;, msg.0)
    }
    rep_msg
}
<span class="boring">}
</span></code></pre></pre>
<ul>
<li>2.ä¸ºäº†é¿å…<code>resp_msg</code>ä½¿ç”¨<code>mut</code>ï¼Œå»ºè®®æ”¹ä½¿ç”¨ä¸‹é¢è¿™ç§æ–¹å¼ï¼š</li>
</ul>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>fn get_msg(msg: &amp;Option&lt;Message&gt;) -&gt; String {
    let rep_msg = if let Some(msg) = msg {
        format!(&quot;{}&quot;, msg.0)
    } else {
        &quot;Ok&quot;.to_string()
    };
    rep_msg
}
<span class="boring">}
</span></code></pre></pre>
<p>é€šè¿‡èµ‹å€¼æ–¹å¼ä¼ é€’<code>rep_msg</code>,é¿å…äº†<code>rep_msg</code>çš„å¯å˜æ€§ã€‚</p>
<ul>
<li>3.æœ¬èº«ä¸Šé¢ä»£ç çœ‹èµ·æ¥è¿˜æ˜¯æœ‰ç‚¹ç»•å£ï¼Œä¸ºäº†è¡¨è¾¾ç›´è§‚ï¼Œé€šè¿‡ä»£ç å—<code>{}</code>ï¼Œå¯è¡¨è¾¾ä¸ºä¸‹é¢æ–¹å¼ï¼š</li>
</ul>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>fn get_msg(msg: &amp;Option&lt;Message&gt;) -&gt; String {
    let rep_msg = {
        if let Some(msg) = msg {
            format!(&quot;{}&quot;, msg.0)
        } else {
            &quot;Ok&quot;.to_string()
        }
    };
    rep_msg
}
<span class="boring">}
</span></code></pre></pre>
<ul>
<li>4.ä½†æ˜¯ä¸Šé¢ä»£ç çœ‹èµ·æ¥è¿˜æ˜¯æœ‰ç‚¹å•°å—¦ï¼Œæˆ‘ä»¬ç»§ç»­ä¼˜åŒ–ï¼Œå¯ä»¥é‡‡ç”¨<code>Option</code>çš„ç»„åˆå­æ–¹æ³•ï¼Œé“¾å¼è¡¨è¾¾ï¼Œä¿®æ”¹å¦‚ä¸‹</li>
</ul>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>fn get_msg(msg: &amp;Option&lt;Message&gt;) -&gt; String {
    msg.as_ref().map(|msg| format!(&quot;{}&quot;, msg.0)).unwrap_or(&quot;Ok&quot;.to_string())
}
<span class="boring">}
</span></code></pre></pre>
<p>æ˜¯ä¸æ˜¯ä½¿ç”¨combinatorçš„æ¨¡å¼ï¼Œä»£ç æ›´ç®€å•ã€ç›´è§‚äº†ã€‚ä½†æ˜¯ï¼Œè¿™é‡Œè¿˜æ˜¯æœ‰ç‚¹ç¼ºé™·ï¼Œæˆ‘ä»¬ç»§ç»­å¾€ä¸‹çœ‹ï¼š</p>
<ul>
<li>5.å¦‚æœä½¿ç”¨<code>cargo clippy</code>çš„ä½¿ç”¨ï¼Œ<code>clippy</code>ä¼šç»å¸¸æç¤ºæˆ‘ä»¬ä¿®æ”¹è¿™æ®µé€»è¾‘ï¼š</li>
</ul>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>msg.unwrap_or(&quot;Ok&quot;.to_string())
 ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^ help: try this: `unwrap_or_else(|| &quot;OK&quot;.to_string())`
                                          |
<span class="boring">}
</span></code></pre></pre>
<p>ä¸ºä»€ä¹ˆå‘¢ï¼Ÿå¯¹äº<code>unwrap_or</code>,å³ä½¿ä¸ä½¿ç”¨å…¶å€¼ï¼Œå‚æ•°<code>&quot;Ok&quot;.to_string()</code>ä¹Ÿå°†è¿›è¡Œæ±‚å€¼ã€‚å¯¹äº<code>unwrap_or_else</code>ï¼Œå‚æ•°æ¥æ”¶ä¸€ä¸ªé—­åŒ…ï¼Œ
å½“è§¦å‘<code>unwrap_or_else</code>è°ƒç”¨æ—¶ï¼Œé€šè¿‡ä¼ é€’å‡½æ•°(é—­åŒ…)è¿›è¡Œæƒ°æ€§æ±‚å€¼(lazy evaluation)è®¡ç®—ï¼Œæå‡ç¨‹åºæ€§èƒ½,é‚£æˆ‘ä»¬æ”¹é€ ä¸‹</p>
<pre><pre class="playground"><code class="language-rust">
<span class="boring">#![allow(unused)]
</span><span class="boring">fn main() {
</span>fn get_msg(msg: &amp;Option&lt;Message&gt;) -&gt; String {
    msg.as_ref().map(|msg| format!(&quot;{}&quot;, msg.0)).unwrap_or_else(||&quot;Ok&quot;.to_string())
}
<span class="boring">}
</span></code></pre></pre>
<p>ä»ç¬¬ä¸€ä¸ªå‡½æ•°çœ‹åˆ°ç°åœ¨ï¼Œæœ‰ä¹ˆæœ‰æ”¶è·å‘¢ï¼Ÿæ¬¢è¿å¤§å®¶åœ¨è¯„è®ºåŒºç•™è¨€ï¼Œä¸€èµ·äº¤æµã€‚</p>
<h2><a class="header" href="#æœ€å" id="æœ€å">æœ€å</a></h2>
<p>æ¨èå¤§å®¶åœ¨Rusté¡¹ç›®ä¸­ï¼Œå°† <a href="https://github.com/rust-lang/rust-clippy">clippy</a> è¿™ä¸ªæ’ä»¶ä½¿ç”¨èµ·æ¥ï¼Œä¼˜åŒ–ç¨‹åºçš„ç»“æ„ã€‚è®©ä¼˜ç§€æˆä¸ºä¸€ç§ä¹ æƒ¯ã€‚</p>
<h2><a class="header" href="#å‚è€ƒé“¾æ¥-1" id="å‚è€ƒé“¾æ¥-1">å‚è€ƒé“¾æ¥</a></h2>
<ul>
<li><a href="https://github.com/rust-lang/rust/pull/55014">https://github.com/rust-lang/rust/pull/55014</a></li>
<li><a href="https://stackoverflow.com/questions/56726571/why-choosing-unwrap-or-else-over-unwrap-or">https://stackoverflow.com/questions/56726571/why-choosing-unwrap-or-else-over-unwrap-or</a></li>
<li><a href="https://stackoverflow.com/questions/45547293/why-should-i-prefer-optionok-or-else-instead-of-optionok-or">https://stackoverflow.com/questions/45547293/why-should-i-prefer-optionok-or-else-instead-of-optionok-or</a></li>
</ul>
<h1><a class="header" href="#golang" id="golang">golang</a></h1>
<p>golang æ‚è°ˆ</p>

                    </main>

                    <nav class="nav-wrapper" aria-label="Page navigation">
                        <!-- Mobile navigation buttons -->
                        

                        

                        <div style="clear: both"></div>
                    </nav>
                </div>
            </div>

            <nav class="nav-wide-wrapper" aria-label="Page navigation">
                

                
            </nav>

        </div>

        

        

        

        
        <script type="text/javascript">
            window.playground_copyable = true;
        </script>
        

        

        
        <script src="elasticlunr.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="mark.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="searcher.js" type="text/javascript" charset="utf-8"></script>
        

        <script src="clipboard.min.js" type="text/javascript" charset="utf-8"></script>
        <script src="highlight.js" type="text/javascript" charset="utf-8"></script>
        <script src="book.js" type="text/javascript" charset="utf-8"></script>

        <!-- Custom JS scripts -->
        

        
        
        <script type="text/javascript">
        window.addEventListener('load', function() {
            window.setTimeout(window.print, 100);
        });
        </script>
        
        

    </body>
</html>
